<!doctype html>
<html lang="en" dir="ltr" style="--primary-rgb: 28,103,147;">

<head>
    {% load static %}
    <!-- META DATA -->
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sash – Bootstrap 5  Admin & Dashboard Template">
    <meta name="author" content="Spruko Technologies Private Limited">
    <meta name="keywords" content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit.">

    <!-- FAVICON -->
    <link rel="shortcut icon" type="image/x-icon" href=" {% static '/assets/images/brand/favicon.ico' %} ">

    <!-- TITLE -->
    <title>Global Monarch</title>

    <!-- BOOTSTRAP CSS -->
    <link id="style" href=" {% static '/assets/plugins/bootstrap/css/bootstrap.min.css' %} " rel="stylesheet">

    <!-- STYLE CSS -->
     <link href=" {% static '/assets/css/style.css' %} " rel="stylesheet">

	<!-- Plugins CSS -->
    <link href=" {% static '/assets/css/plugins.css' %} " rel="stylesheet">

    <!--- FONT-ICONS CSS -->
    <link href=" {% static '/assets/css/icons.css' %} " rel="stylesheet">

    <!-- INTERNAL Switcher css -->
    <link href=" {% static '/assets/switcher/css/switcher.css' %} " rel="stylesheet">
    <link href=" {% static '/assets/switcher/demo.css' %} " rel="stylesheet">
</head>

<body class="app sidebar-mini ltr light-mode">

    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src=" {% static '/assets/images/loader.gif' %} " class="loader-img" alt="Loader">
    </div>
    <!-- /GLOBAL-LOADER -->

    <!-- PAGE -->
    <div class="page">
        <div class="page-main">

            <!-- app-Header -->
            <div class="app-header header sticky">
                <div class="container-fluid main-container">
                    <div class="d-flex">
                        <a aria-label="Hide Sidebar" class="app-sidebar__toggle" data-bs-toggle="sidebar" href=" {% static 'javascript:void(0)' %} "></a>
                        <!-- sidebar-toggle-->
                        <a class="logo-horizontal " href=" {% static 'index.html' %} ">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>

                       
                        <div class="d-flex order-lg-2 ms-auto header-right-icons">
                            <!-- SEARCH -->
                            <button class="navbar-toggler navresponsive-toggler d-lg-none ms-auto" type="button"
                                data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent-4"
                                aria-controls="navbarSupportedContent-4" aria-expanded="false"
                                aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon fe fe-more-vertical"></span>
                            </button>
                            <div class="navbar navbar-collapse responsive-navbar p-0">
                                <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
                                    <div class="d-flex order-lg-2">
                                            <a href="{% static 'javascript:void(0)' %}" class="nav-link icon"
                                                data-bs-toggle="dropdown" data-target="">
                                                <i class="fa fa-sort-down"></i>
                                            </a>
                                            <div class="dropdown  d-flex notifications">
                                                <a class="nav-link icon" data-bs-toggle="dropdown" aria-expanded="false"><i class="fe fe-bell"></i><span class=" pulse"></span>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                    <div class="drop-heading border-bottom">
                                                        <div class="d-flex">
                                                            <h6 class="mt-1 mb-0 fs-16 fw-semibold text-dark">Notifications
                                                            </h6>
                                                        </div>
                                                    </div>
                                                    <div class="notifications-menu ps">
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-primary brround box-shadow-primary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">New change made to enquiry of FM96 to Kumas
                                                                </h5>
                                                                <span class="notification-subtext">1 hour ago</span>
                                                            </div>
                                                        </a>
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-secondary brround box-shadow-secondary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">Enquiry deadline coming up</h5>
                                                                <span class="notification-subtext">2 hours ago</span>
                                                            </div>
                                                        </a>
                                                       
                                                    <div class="ps__rail-x" style="left: 0px; bottom: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div></div></div>
                                                    <div class="dropdown-divider m-0"></div>
                                                    <a href="notify-list.html" class="dropdown-item text-center p-3 text-muted">View all
                                                        Notification</a>
                                                </div>
                                            </div>
                                        <!-- SIDE-MENU -->
                                        <div class="dropdown d-flex profile-1">
                                            <a href=" {% static 'javascript:void(0)' %} " data-bs-toggle="dropdown" class="nav-link leading-none d-flex">
                                                <img src=" {% static '/assets/images/users/21.jpg' %} " alt="profile-user"
                                                    class="avatar  profile-user brround cover-image">
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                <div class="drop-heading">
                                                    <div class="text-center">
                                                        <h5 class="text-dark mb-0 fs-14 fw-semibold">{{request.user.username}}</h5>
                                                    </div>
                                                </div>
                                                <div class="dropdown-divider m-0"></div>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-user"></i> Profile
                                                </a>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-alert-circle"></i> Sign out
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /app-Header -->

            <!--APP-SIDEBAR-->
            <div class="sticky">
                <div class="app-sidebar__overlay" data-bs-toggle="sidebar"></div>
                <div class="app-sidebar">
                    <div class="side-header">
                        <a class="header-brand1" href="">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-white.png' %} " class="header-brand-img toggle-logo"
                                alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-dark.png' %} " class="header-brand-img light-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>
                        <!-- LOGO -->
                    </div>
                    <div class="main-sidemenu">
                        <div class="slide-left disabled" id="slide-left"><svg xmlns="http://www.w3.org/2000/svg"
                                fill="#7b8191" width="24" height="24" viewBox="0 0 24 24">
                                <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" />
                            </svg></div>
                            <ul class="side-menu">
                           
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                            class="side-menu__icon fe fe-home"></i><span
                                            class="side-menu__label">Home</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/enquiry_list"><i
                                            class="side-menu__icon fe fe-send"></i><span
                                            class="side-menu__label">Enquiries</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                            class="side-menu__icon fe fe-pie-chart"></i><span
                                            class="side-menu__label">Create new Enquiry</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/supplier_list"><i
                                            class="side-menu__icon fe fe-activity"></i><span
                                            class="side-menu__label">Supplier Management</span></a>
                                </li>
    
                            </ul>
                        <div class="slide-right" id="slide-right"><svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191"
                                width="24" height="24" viewBox="0 0 24 24">
                                <path d="M10.707 17.707 16.414 12l-5.707-5.707-1.414 1.414L13.586 12l-4.293 4.293z" />
                            </svg></div>
                    </div>
                </div>
            </div>
            <!--/APP-SIDEBAR-->
<!--app-content open-->
<div class="main-content app-content mt-0">
    <div class="side-app">

        <!-- CONTAINER -->
        <div class="main-container container-fluid">

            <!-- PAGE-HEADER -->
            <div class="page-header">
                <h1 class="page-title">Supplier Information</h1>
                <!-- Breadcrumb and other header content -->
            </div>
            <!-- PAGE-HEADER END -->

            <!-- Supplier Details Section -->
            <div class="row d-flex">
                <div class="col-lg-12 d-flex">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="card-title">Supplier Details</div>
                        </div>
                        <div class="card-body">
                            <!-- Single row for all details to ensure even spacing -->
                            <form id="supplierForm">
                                <div class="row">
                                    <div class="col-md-4 mb-2">
                                        <label for="supplierName">Supplier Name</label>
                                        <input type="text" class="form-control" id="supplierName" name="name" value="{{ supplier.name }}">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label for="supplierDivision">Supplier Division</label>
                                        <select class="form-control form-select select2" id="supplierDivision" name="division">
                                            {% for division in divisions %}
                                                <option value="{{ division.id }}" {% if supplier.division and supplier.division.id == division.id %}selected{% endif %}>{{ division.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label for="supplierCountry">Supplier Country</label>
                                        <input type="text" class="form-control" id="supplierCountry" name="country" value="{{ supplier_country }}">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 d-flex">
                        <div class="card">
                                <div class="panel panel-primary">
                                    <div class="tab-menu-heading">
                                        <div class="tabs-menu">
                                            <ul class="nav panel-tabs" role="tablist">
                                                <li class="nav-item">
                                                    <a href="#recentOffer" class="nav-link active" data-bs-toggle="tab" role="tab" aria-selected="true">Recent Offer</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#summaryStats" class="nav-link" data-bs-toggle="tab" role="tab" aria-selected="false">Summary Stats</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#contactDetails" class="nav-link" data-bs-toggle="tab" role="tab" aria-selected="false">Contact Details</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#productsSupplied" class="nav-link" data-bs-toggle="tab" role="tab" aria-selected="false">Products Supplied</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#meetinghistory" class="nav-link" data-bs-toggle="tab" role="tab" aria-selected="false">Meetings History</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="panel-body tabs-menu-body">
                                        <div class="tab-content">
                                            <!-- Recent Offer Tab -->
                                            <div class="tab-pane active" id="recentOffer" role="tabpanel">
                                                <div class="col-xl-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Recent Offer</h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <div>
                                                                <input type="text" class="form-control d-inline-block mr-2" style="width: 200px;" placeholder="Search offers...">
                                                                <button class="btn btn-primary btn-export-csv">Export as CSV</button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body">
                                                            {% if offers %}
                                                            <table class="table table-striped">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Supplier Price</th>
                                                                        <th>Product</th>
                                                                        <th>Incoterms</th>
                                                                        <th>Specs</th>
                                                                        <th>Size</th>
                                                                        <!-- Add other headers -->
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {% for offer in offers %}
                                                                    <tr>
                                                                        <td>{{ offer.supplier_price }}</td>
                                                                        <td>{{ offer.request.product.name }}</td>
                                                                        <td>{{ offer.incoterms }}</td>
                                                                        <td>{{ offer.specs }}</td>
                                                                        <td>{{ offer.size }}</td>
                                                                    </tr>
                                                                    {% endfor %}
                                                                </tbody>
                                                            </table>
                                                            {% else %}
                                                            <p>No recent offers found.</p>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Summary Stats Tab -->
                                            <div class="tab-pane" id="summaryStats" role="tabpanel">
                                                <div class="col-xl-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Summary Stats</h3>
                                                        </div>
                                                        <div class="card-body">
                                                            {% for stat in product_stats %}
                                                            <div class="row">
                                                                <!-- Supplier Name -->
                                                                <div class="col-md-4 mb-4">
                                                                    <label for="exampleInputEmail1">{{ stat.request__product__name }}</label>
                                                                </div>
                                                                <!-- Supplier Contact Person -->
                                                                <div class="col-md-4 mb-4">
                                                                    <label for="exampleInputEmail1">Average Price: {{ stat.average_price }}</label>
                                                                </div>
                                                                <!-- Supplier Email -->
                                                                <div class="col-md-4 mb-4">
                                                                    <label for="exampleInputEmail1">Total Offers: {{ stat.total_offers }}</label>
                                                                </div>
                                                            </div>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Products Supplied Tab -->
                                            <div class="tab-pane" id="productsSupplied" role="tabpanel">
                                                <div class="col-xl-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Products Supplied</h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <button id="addProductBtn" class="btn btn-primary mb-4"> Add New Product</button>
                                                            <div class="table-responsive">
                                                                <table class="table table-bordered border text-nowrap mb-0" id="products-table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Product Name</th>
                                                                            <th>Actions</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for product in supplier.products.all %}
                                                                        <tr data-product-id="{{ product.id }}">
                                                                            <td>{{ product.name }}</td>
                                                                            <td name="bstable-actions">
                                                                                <div class="btn-list">
                                                                                    <button type="button" class="btn btn-sm btn-danger delete-product" data-product-id="{{ product.id }}">
                                                                                        <span class="fe fe-trash-2"></span>
                                                                                    </button>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div id="addProductModal" class="modal fade" tabindex="-1" role="dialog">
                                                                <div class="modal-dialog" role="document">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title">Add New Product</h5>
                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                <span aria-hidden="true">&times;</span>
                                                                            </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <label for="newProduct">Select Product:</label>
                                                                            <select id="newProduct" class="form-control select2-show-search form-select select2-hidden-accessible">
                                                                                {% for product in all_products %}
                                                                                <option value="{{ product.id }}">{{ product.name }}</option>
                                                                                {% endfor %}
                                                                            </select>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-primary" id="confirmAddProduct">Add Product</button>
                                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="contactDetails" role="tabpanel">
                                                <div class="col-xl-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Contact Details</h3>
                                                            <div class="card-options">
                            
                                                                <button id="addContactBtn" class="btn btn-primary btn-sm mr-2"> Add New Contact</button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-edit-contacts">Edit All</button>
                                                                <button type="button" class="btn btn-success btn-sm btn-save-contacts" style="display:none;">Save All</button>

                                                            </div>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="table-responsive">
                                                                <table class="table table-bordered border text-nowrap mb-0" id="contacts-table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Name</th>
                                                                            <th>Email</th>
                                                                            <th>Phone</th>
                                                                            <th>Personal Phone</th>
                                                                            <th>Job Title</th>
                                                                            <th>Actions</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for contact in contacts %}
                                                                        <tr data-contact-id="{{ contact.id }}">
                                                                            <td>{{ contact.name }}</td>
                                                                            <td>{{ contact.email }}</td>
                                                                            <td>{{ contact.phone }}</td>
                                                                            <td>{{ contact.personal_phone }}</td>
                                                                            <td>{{ contact.job_title }}</td>
                                                                            <td name="bstable-actions">
                                                                                <div class="btn-list">
                                                                                    <button type="button" class="btn btn-sm btn-danger delete-contact" data-contact-id="{{ contact.id }}">
                                                                                        <span class="fe fe-trash-2"></span>
                                                                                    </button>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div id="addContactModal" class="modal fade" tabindex="-1" role="dialog">
                                                                <div class="modal-dialog" role="document">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title">Add New Contact</h5>
                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                <span aria-hidden="true">&times;</span>
                                                                            </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <div class="form-group">
                                                                                <label for="newContactName">Name:</label>
                                                                                <input type="text" id="newContactName" class="form-control">
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label for="newContactEmail">Email:</label>
                                                                                <input type="email" id="newContactEmail" class="form-control">
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label for="newContactPhone">Phone:</label>
                                                                                <input type="text" id="newContactPhone" class="form-control">
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label for="newContactPersonalPhone">Personal Phone:</label>
                                                                                <input type="text" id="newContactPersonalPhone" class="form-control">
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label for="newContactJobTitle">Job Title:</label>
                                                                                <input type="text" id="newContactJobTitle" class="form-control">
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-primary" id="confirmAddContact">Add Contact</button>
                                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="editContactModal" class="modal fade" tabindex="-1" role="dialog">
                                                                <div class="modal-dialog" role="document">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title">Edit Contact</h5>
                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                <span aria-hidden="true">&times;</span>
                                                                            </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <label for="editContactName">Name:</label>
                                                                            <input type="text" id="editContactName" class="form-control">
                                                                            <label for="editContactEmail">Email:</label>
                                                                            <input type="email" id="editContactEmail" class="form-control">
                                                                            <label for="editContactPhone">Phone:</label>
                                                                            <input type="text" id="editContactPhone" class="form-control">
                                                                            <label for="editContactPersonalPhone">Personal Phone:</label>
                                                                            <input type="text" id="editContactPersonalPhone" class="form-control">
                                                                            <label for="editContactJobTitle">Job Title:</label>
                                                                            <input type="text" id="editContactJobTitle" class="form-control">
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-primary" id="confirmEditContact">Save Changes</button>
                                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="meetinghistory" role="tabpanel">
                                                    <div class="col-xl-12">
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h3 class="card-title">Meeting History</h3>
                                                            </div>
                                                            <div class="card-body">
                                                                <ul>
                                                                </ul>
                                                            </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>                                                
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 

<!-- FOOTER -->
<footer class="footer">
    <div class="container">
        <div class="row align-items-center flex-row-reverse">
            <div class="col-md-12 col-sm-12 text-center">
                Copyright © <span id="year"></span> Global Monarch F.Z.C. Designed with <span class="fa fa-heart text-danger"></span> by <a href="javascript:void(0)"> GM-EU</a> All rights reserved.
            </div>
        </div>
    </div>
</footer>
<!-- FOOTER CLOSED -->
</div>

     

<!-- BACK-TO-TOP -->
<a href=" {% static '#top' %} " id="back-to-top"><i class="fa fa-angle-up"></i></a>

   <!-- JQUERY JS -->
   <script src=" {% static '/assets/js/jquery.min.js' %} "></script>

   <!-- BOOTSTRAP JS -->
   <script src=" {% static '/assets/plugins/bootstrap/js/popper.min.js' %} "></script>
   <script src=" {% static '/assets/plugins/bootstrap/js/bootstrap.min.js' %} "></script>

   <!-- SPARKLINE JS-->
   <script src=" {% static '/assets/js/jquery.sparkline.min.js' %} "></script>

   <!-- Select2 js-->
   <script src=" {% static '/assets/plugins/select2/select2.full.min.js' %} "></script>
   <script src=" {% static '/assets/js/select2.js' %} "></script>

   <!-- TypeHead js -->
   <script src=" {% static '/assets/plugins/bootstrap5-typehead/autocomplete.js' %} "></script>
   <script src=" {% static '/assets/js/typehead.js' %} "></script>

   <!-- INTERNAL Edit-Table JS -->
   <script src=" {% static '/assets/plugins/edit-table/bst-edittable.js' %} "></script>
   <script src=" {% static '/assets/plugins/edit-table/edit-table.js' %} "></script>

   <!-- Perfect SCROLLBAR JS-->
   <script src=" {% static '/assets/plugins/p-scroll/perfect-scrollbar.js' %} "></script>
   <script src=" {% static '/assets/plugins/p-scroll/pscroll.js' %} "></script>
   <script src=" {% static '/assets/plugins/p-scroll/pscroll-1.js' %} "></script>

   <!-- SIDE-MENU JS -->
   <script src=" {% static '/assets/plugins/sidemenu/sidemenu.js' %} "></script>

   <!-- SIDEBAR JS -->
   <script src=" {% static '/assets/plugins/sidebar/sidebar.js' %} "></script>

   <!-- Color Theme js -->
   <script src=" {% static '/assets/js/themeColors.js' %} "></script>

   <!-- Sticky js -->
   <script src=" {% static '/assets/js/sticky.js' %} "></script>

   <!-- CUSTOM JS -->
   <script src=" {% static '/assets/js/custom.js' %} "></script>

   <!-- Custom-switcher -->
   <script src=" {% static '/assets/js/custom-swicher.js' %} "></script>

   <!-- Switcher js -->
   <script src=" {% static '/assets/switcher/js/switcher.js' %} "></script>



<script>
    $(document).ready(function() {
        // Search functionality
        $('input[type="text"]').on('keyup', function() {
            var value = $(this).val().toLowerCase();
            $('table tbody tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });

        // Export to CSV functionality
        $('.btn-export-csv').on('click', function() {
            var csv = [];
            var rows = document.querySelectorAll('table tr');
            
            for (var i = 0; i < rows.length; i++) {
                var row = [], cols = rows[i].querySelectorAll('td, th');
                
                for (var j = 0; j < cols.length; j++) 
                    row.push(cols[j].innerText);
                
                csv.push(row.join(','));        
            }

            // Download CSV
            var csvFile = new Blob([csv.join('\n')], {type: 'text/csv'});
            var downloadLink = document.createElement('a');
            downloadLink.download = 'offers.csv';
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
        });
    });
</script>

<script>
   $(document).ready(function(){
    $('#supplierForm input, #supplierForm select').on('change', function() {
        var formData = {
            'name': $('#supplierName').val(),
            'contact_person': $('#supplierContactPerson').val(),
            'email': $('#supplierEmail').val(),
            'division': $('#supplierDivision').val(),
            'country': $('#supplierCountry').val(),
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            'contact_id': $('#contactId').val()
        };
        $.ajax({
            url: "{% url 'update_supplier' supplier.id %}",
            type: "POST",
            data: formData,
            success: function(response) {
                console.log('Supplier details updated successfully');
            },
            error: function(response) {
                console.log('Error updating supplier details');
            }
        });
    });
});
</script>
    
    <script>
        $(document).ready(function() {
            // Open add product modal
            $('#addProductBtn').on('click', function() {
                $('#addProductModal').modal('show');
            });

            // Initialize select2 after the modal is shown
    $('#addProductModal').on('shown.bs.modal', function () {
        // Populate the select element with supplier options
        let $select = $('#newProduct');
        $('.select2-show-search').select2({
            dropdownParent: $('#addProductModal'), // Ensure dropdown is appended to the modal
            width: '100%',
            tags: true,
            minimumInputLength: 1,
            placeholder: "Select suppliers",
            createTag: function(params) {
                var term = $.trim(params.term);
                if (term === '') {
                    return null;
                }
                var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                var exists = $('.select2-show-search').find('option').filter(function() {
                    return $(this).text().toLowerCase() === normalizedTerm;
                }).length > 0;
                if (exists) {
                    return null;
                }
                return {
                    id: term,
                    text: term,
                    newTag: true
                };
            }
        }).on('select2:select', function(e) {
            if (e.params.data.newTag) {
                console.log("New option added:", e.params.data.text);
                // Additional logic for new tags can be implemented here
            }
        });
    });
        
            // Add product to supplier
            $('#confirmAddProduct').on('click', function() {
                var productId = $('#newProduct').val();
                var supplierId = {{ supplier.id }};
                var productName = $('#newProduct option:selected').text();
                
                $.ajax({
                    url: "{% url 'add_product_to_supplier' %}",
                    type: "POST",
                    data: {
                        'product_id': productId,
                        'supplier_id': supplierId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            $('#products-table tbody').append(
                                '<tr data-product-id="' + productId + '"><td>' + productName + '</td><td name="bstable-actions"><div class="btn-list"><button type="button" class="btn btn-sm btn-danger delete-product" data-product-id="' + productId + '"><span class="fe fe-trash-2"></span></button></div></td></tr>'
                            );
                            $('#addProductModal').modal('hide');
                        }
                    },
                    error: function(response) {
                        console.error('Error adding product');
                    }
                });
            });
        
            // Delete product from supplier
            $('#products-table').on('click', '.delete-product', function() {
                var productId = $(this).data('product-id');
                var supplierId = {{ supplier.id }};
                var row = $(this).closest('tr');
                
                $.ajax({
                    url: "{% url 'delete_product_from_supplier' %}",
                    type: "POST",
                    data: {
                        'product_id': productId,
                        'supplier_id': supplierId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            row.remove();
                        }
                    },
                    error: function(response) {
                        console.error('Error deleting product');
                    }
                });
            });
        });
        </script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const supplierId = '{{ supplier.id }}';  // Ensure supplier_id is correctly set from Django template context
    
        // Function to get CSRF token from cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        // Show Add Contact Modal
        document.getElementById('addContactBtn').addEventListener('click', function () {
            $('#addContactModal').modal('show');
        });
    
        // Add New Contact
        document.getElementById('confirmAddContact').addEventListener('click', function () {
            var newContactName = document.getElementById('newContactName').value;
            var newContactEmail = document.getElementById('newContactEmail').value;
            var newContactPhone = document.getElementById('newContactPhone').value;
            var newContactPersonalPhone = document.getElementById('newContactPersonalPhone').value;
            var newContactJobTitle = document.getElementById('newContactJobTitle').value;
    
            fetch(`/add_supplier_contact/${supplierId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({
                    contact_person: newContactName,
                    contact_email: newContactEmail,
                    contact_phone: newContactPhone,
                    personal_phone: newContactPersonalPhone,
                    job_title: newContactJobTitle
                }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    var newRow = document.createElement('tr');
                    newRow.dataset.contactId = data.contact_id;
                    newRow.innerHTML = `
                        <td>${newContactName}</td>
                        <td>${newContactEmail}</td>
                        <td>${newContactPhone}</td>
                        <td>${newContactPersonalPhone}</td>
                        <td>${newContactJobTitle}</td>
                        <td name="bstable-actions">
                            <div class="btn-list">
                                <button type="button" class="btn btn-sm btn-danger delete-contact" data-contact-id="${data.contact_id}">
                                    <span class="fe fe-trash-2"></span>
                                </button>
                            </div>
                        </td>
                    `;
                    document.querySelector('#contacts-table tbody').appendChild(newRow);
                    $('#addContactModal').modal('hide');
                } else {
                    alert('Failed to add contact.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    
        // Edit All Contacts
        document.querySelector('.btn-edit-contacts').addEventListener('click', function () {
            var table = document.getElementById('contacts-table');
            var cells = table.querySelectorAll('tbody tr td:not([name="bstable-actions"])');
            cells.forEach(cell => cell.setAttribute('contenteditable', 'true'));
            this.style.display = 'none';
            document.querySelector('.btn-save-contacts').style.display = 'inline-block';
        });
    
        // Save All Contacts
        document.querySelector('.btn-save-contacts').addEventListener('click', function () {
            var table = document.getElementById('contacts-table');
            var rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                var contactId = row.dataset.contactId;
                var cells = row.querySelectorAll('td');
                var contactData = {
                    name: cells[0].innerText,
                    email: cells[1].innerText,
                    phone: cells[2].innerText,
                    personal_phone: cells[3].innerText,
                    job_title: cells[4].innerText
                };
                fetch(`/update_contact/${contactId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify(contactData),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status !== 'success') {
                        alert('Failed to save contact.');
                    }
                })
                .catch(error => console.error('Error:', error));
            });
            var cells = table.querySelectorAll('tbody tr td:not([name="bstable-actions"])');
            cells.forEach(cell => cell.setAttribute('contenteditable', 'false'));
            this.style.display = 'none';
            document.querySelector('.btn-edit-contacts').style.display = 'inline-block';
        });
    
        // Event delegation for deleting contact
        document.querySelector('#contacts-table tbody').addEventListener('click', function(event) {
            if (event.target.closest('.delete-contact')) {
                const contactId = event.target.closest('.delete-contact').dataset.contactId;
                fetch(`/delete_contact/${contactId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        event.target.closest('tr').remove();
                    } else {
                        alert('Failed to delete contact.');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    
        // Update Supplier Form Submission
        document.getElementById('supplierForm').addEventListener('submit', function (e) {
            e.preventDefault();
            var formData = new FormData(this);
            fetch(`/update_supplier/${supplierId}/`, {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Supplier details updated successfully.');
                    location.reload();
                } else {
                    alert('Failed to update supplier details.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
    </script>
</body>

</html>