<!DOCTYPE html>
<html lang="en" dir="ltr" style="--primary-rgb: 28, 103, 147">
  <head>
    {% load static %}
    <!-- META DATA -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="description"
      content="Sash – Bootstrap 5  Admin & Dashboard Template"
    />
    <meta name="author" content="Spruko Technologies Private Limited" />
    <meta
      name="keywords"
      content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit."
    />
    <style>
      table#basic-datatable tbody tr {
        cursor: pointer;
      }

      table#basic-datatable tbody tr:hover {
        background-color: rgb(28, 103, 147);
        color: #ffffff;
      }
    </style>
    <!-- FAVICON -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href=" {% static '/assets/images/brand/favicon.ico' %} "
    />

    <!-- TITLE -->
    <title>Global Monarch</title>

    <!-- BOOTSTRAP CSS -->
    <link
      id="style"
      href=" {% static '/assets/plugins/bootstrap/css/bootstrap.min.css' %} "
      rel="stylesheet"
    />

    <!-- STYLE CSS -->
    <link href=" {% static '/assets/css/style.css' %} " rel="stylesheet" />

    <!-- Plugins CSS -->
    <link href=" {% static '/assets/css/plugins.css' %} " rel="stylesheet" />

    <!--- FONT-ICONS CSS -->
    <link href=" {% static '/assets/css/icons.css' %} " rel="stylesheet" />

    <!-- INTERNAL Switcher css -->
    <link
      href=" {% static '/assets/switcher/css/switcher.css' %} "
      rel="stylesheet"
    />
    <link href=" {% static '/assets/switcher/demo.css' %} " rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css"
      rel="stylesheet"
    />
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>

  <body class="app sidebar-mini ltr light-mode">
    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
      <img
        src=" {% static '/assets/images/loader.gif' %} "
        class="loader-img"
        alt="Loader"
      />
    </div>
    <!-- /GLOBAL-LOADER -->

    <!-- PAGE -->
    <div class="page">
      <div class="page-main">
        <!-- app-Header -->
        <div class="app-header header sticky">
          <div class="container-fluid main-container">
            <div class="d-flex">
              <a
                aria-label="Hide Sidebar"
                class="app-sidebar__toggle"
                data-bs-toggle="sidebar"
                href=" {% static 'javascript:void(0)' %} "
              ></a>
              <!-- sidebar-toggle-->
              <a class="logo-horizontal" href=" {% static 'index.html' %} ">
                <img
                  src=" {% static '/assets/images/brand/logo-white.png' %} "
                  class="header-brand-img desktop-logo"
                  alt="logo"
                />
                <img
                  src=" {% static '/assets/images/brand/logo-dark.png' %} "
                  class="header-brand-img light-logo1"
                  alt="logo"
                />
              </a>

              <div class="d-flex order-lg-2 ms-auto header-right-icons">
                <!-- SEARCH -->
                <button
                  class="navbar-toggler navresponsive-toggler d-lg-none ms-auto"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#navbarSupportedContent-4"
                  aria-controls="navbarSupportedContent-4"
                  aria-expanded="false"
                  aria-label="Toggle navigation"
                >
                  <span class="navbar-toggler-icon fe fe-more-vertical"></span>
                </button>
                <div class="navbar navbar-collapse responsive-navbar p-0">
                  <div
                    class="collapse navbar-collapse"
                    id="navbarSupportedContent-4"
                  >
                    <div class="d-flex order-lg-2">
                      <a
                        href="{% static 'javascript:void(0)' %}"
                        class="nav-link icon"
                        data-bs-toggle="dropdown"
                        data-target=""
                      >
                        <i class="fa fa-sort-down"></i>
                      </a>
                      <div class="dropdown d-flex notifications">
                        <a
                          class="nav-link icon"
                          data-bs-toggle="dropdown"
                          aria-expanded="false"
                          ><i class="fe fe-bell"></i><span class="pulse"></span>
                        </a>
                        <div
                          class="dropdown-menu dropdown-menu-end dropdown-menu-arrow"
                        >
                          <div class="drop-heading border-bottom">
                            <div class="d-flex">
                              <h6 class="mt-1 mb-0 fs-16 fw-semibold text-dark">
                                Notifications
                              </h6>
                            </div>
                          </div>
                          <div class="notifications-menu ps">
                            <a
                              class="dropdown-item d-flex"
                              href="notify-list.html"
                            >
                              <div
                                class="me-3 notifyimg bg-primary brround box-shadow-primary"
                              >
                                <i class="fe fe-mail"></i>
                              </div>
                              <div class="mt-1 wd-80p">
                                <h5 class="notification-label mb-1">
                                  New change made to enquiry of FM96 to Kumas
                                </h5>
                                <span class="notification-subtext"
                                  >1 hour ago</span
                                >
                              </div>
                            </a>
                            <a
                              class="dropdown-item d-flex"
                              href="notify-list.html"
                            >
                              <div
                                class="me-3 notifyimg bg-secondary brround box-shadow-secondary"
                              >
                                <i class="fe fe-mail"></i>
                              </div>
                              <div class="mt-1 wd-80p">
                                <h5 class="notification-label mb-1">
                                  Enquiry deadline coming up
                                </h5>
                                <span class="notification-subtext"
                                  >2 hours ago</span
                                >
                              </div>
                            </a>

                            <div
                              class="ps__rail-x"
                              style="left: 0px; bottom: 0px"
                            >
                              <div
                                class="ps__thumb-x"
                                tabindex="0"
                                style="left: 0px; width: 0px"
                              ></div>
                            </div>
                            <div
                              class="ps__rail-y"
                              style="top: 0px; right: 0px"
                            >
                              <div
                                class="ps__thumb-y"
                                tabindex="0"
                                style="top: 0px; height: 0px"
                              ></div>
                            </div>
                          </div>
                          <div class="dropdown-divider m-0"></div>
                          <a
                            href="notify-list.html"
                            class="dropdown-item text-center p-3 text-muted"
                            >View all Notification</a
                          >
                        </div>
                      </div>
                      <!-- SIDE-MENU -->
                      <div class="dropdown d-flex profile-1">
                        <a
                          href=" {% static 'javascript:void(0)' %} "
                          data-bs-toggle="dropdown"
                          class="nav-link leading-none d-flex"
                        >
                          <img
                            src=" {% static '/assets/images/users/21.jpg' %} "
                            alt="profile-user"
                            class="avatar profile-user brround cover-image"
                          />
                        </a>
                        <div
                          class="dropdown-menu dropdown-menu-end dropdown-menu-arrow"
                        >
                          <div class="drop-heading">
                            <div class="text-center">
                              <h5 class="text-dark mb-0 fs-14 fw-semibold">
                                {{request.user.username}}
                              </h5>
                            </div>
                          </div>
                          <div class="dropdown-divider m-0"></div>
                          <a class="dropdown-item" href="">
                            <i class="dropdown-icon fe fe-user"></i> Profile
                          </a>
                          <a class="dropdown-item" href="">
                            <i class="dropdown-icon fe fe-alert-circle"></i>
                            Sign out
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /app-Header -->

        <!--APP-SIDEBAR-->
        <div class="sticky">
          <div class="app-sidebar__overlay" data-bs-toggle="sidebar"></div>
          <div class="app-sidebar">
            <div class="side-header">
              <a class="header-brand1" href="">
                <img
                  src=" {% static '/assets/images/brand/logo-white.png' %} "
                  class="header-brand-img desktop-logo"
                  alt="logo"
                />
                <img
                  src=" {% static '/assets/images/brand/icon-white.png' %} "
                  class="header-brand-img toggle-logo"
                  alt="logo"
                />
                <img
                  src=" {% static '/assets/images/brand/icon-dark.png' %} "
                  class="header-brand-img light-logo"
                  alt="logo"
                />
                <img
                  src=" {% static '/assets/images/brand/logo-dark.png' %} "
                  class="header-brand-img light-logo1"
                  alt="logo"
                />
              </a>
              <!-- LOGO -->
            </div>
            <div class="main-sidemenu">
              <div class="slide-left disabled" id="slide-left">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="#7b8191"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"
                  />
                </svg>
              </div>
              <ul class="side-menu">
                <li class="slide">
                  <a
                    class="side-menu__item has-link"
                    data-bs-toggle="slide"
                    href="/"
                    ><i class="side-menu__icon fe fe-home"></i
                    ><span class="side-menu__label">Home</span></a
                  >
                </li>
                <li class="slide">
                  <a
                    class="side-menu__item has-link"
                    data-bs-toggle="slide"
                    href="/enquiry_list"
                    ><i class="side-menu__icon fe fe-send"></i
                    ><span class="side-menu__label">Enquiries</span></a
                  >
                </li>
                <li class="slide">
                  <a
                    class="side-menu__item has-link"
                    data-bs-toggle="slide"
                    href="/"
                    ><i class="side-menu__icon fe fe-pie-chart"></i
                    ><span class="side-menu__label">Create new Enquiry</span></a
                  >
                </li>
                <li class="slide">
                  <a
                    class="side-menu__item has-link"
                    data-bs-toggle="slide"
                    href="/supplier_list"
                    ><i class="side-menu__icon fe fe-activity"></i
                    ><span class="side-menu__label"
                      >Supplier Management</span
                    ></a
                  >
                </li>
              </ul>
              <div class="slide-right" id="slide-right">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="#7b8191"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M10.707 17.707 16.414 12l-5.707-5.707-1.414 1.414L13.586 12l-4.293 4.293z"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>
        <!--/APP-SIDEBAR-->
        <!--app-content open-->
        <div class="main-content app-content mt-0">
          <div class="side-app">
            <!-- CONTAINER -->
            <div class="main-container container-fluid">
              <!-- PAGE-HEADER -->
              <div class="page-header">
                <h1 class="page-title">Enquiry List</h1>
                <div>
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                      <a href=" {% static 'javascript:void(0)' %} ">Pages</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                      Empty
                    </li>
                  </ol>
                </div>
              </div>
              <!-- PAGE-HEADER END VARUN's CODE STARTS HERE -->
            </div>
          </div>
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Ongoing Enquiries</h3>
              </div>
              <div class="card-body">
                <div class="card-body">
                  <div class="row mb-3">
                    <div class="col-sm-12 col-md-6 d-flex align-items-center">
                      <button
                        id="openFiltersButton"
                        class="btn btn-secondary btn-sm"
                      >
                        Filters
                      </button>
                    </div>
                    <div class="col-sm-12 col-md-6 d-flex justify-content-end">
                      <div
                        id="basic-datatable_filter"
                        class="dataTables_filter"
                      >
                        <label><input type="search" id="tableSearch" class="form-control search-input" placeholder="Search..." aria-controls="basic-datatable"/></label>
                      </div>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <div
                      id="basic-datatable_wrapper"
                      class="dataTables_wrapper dt-bootstrap5 no-footer"
                    >
                      <div class="row">
                        <div class="col-sm-12">
                          <table
                            class="table table-bordered text-nowrap border-bottom dataTable no-footer"
                            id="basic-datatable"
                            role="grid"
                            aria-describedby="basic-datatable_info"
                          >
                            <thead>
                              <tr role="row">
                                <th
                                  class="wd-15p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 120.113px"
                                >
                                  ID
                                </th>
                                <th
                                  class="wd-15p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 120.113px"
                                >
                                  Status
                                </th>
                                <th
                                  class="wd-15p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 111.887px"
                                >
                                  Manager
                                </th>
                                <th
                                  class="wd-15p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 111.887px"
                                >
                                  Customer
                                </th>
                                <th
                                  class="wd-20p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 217.938px"
                                >
                                  Products
                                </th>
                                <th
                                  class="wd-15p border-bottom-0 sorting sorting_desc"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  aria-label="Start date: activate to sort column ascending"
                                  style="width: 260px"
                                  aria-sort="descending"
                                >
                                  Enquiry Receive Date
                                </th>
                                <th
                                  class="wd-10p border-bottom-0 sorting"
                                  tabindex="0"
                                  aria-controls="basic-datatable"
                                  rowspan="1"
                                  colspan="1"
                                  style="width: 87.3375px"
                                >
                                  Quantity (MT)
                                </th>
                              </tr>
                            </thead>
                            <tbody></tbody>
                          </table>
                        </div>
                      </div>
                      <!--
                                <div class="row">
                                    <div class="dataTables_info" id="basic-datatable_info" role="status" aria-live="polite">Showing 1 to 10 of 50 entries</div>
                                </div>
                                -->
                      <br />
                      <div class="row">
                        <div class="col-sm-6 col-md-6">
                          <div
                            class="dataTables_length"
                            id="basic-datatable_length"
                          >
                            <label
                              >Show
                              <select
                                name="basic-datatable_length"
                                aria-controls="basic-datatable"
                                class="form-select form-select"
                                id="entries-per-page"
                              >
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                              </select>
                              entries
                            </label>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-6">
                          <div
                            class="dataTables_paginate paging_simple_numbers"
                            id="basic-datatable_paginate"
                          >
                            <ul class="pagination">
                              <li
                                class="paginate_button page-item previous disabled"
                                id="basic-datatable_previous"
                              >
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="0"
                                  tabindex="0"
                                  class="page-link"
                                  >Previous</a
                                >
                              </li>
                              <li class="paginate_button page-item active">
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="1"
                                  tabindex="0"
                                  class="page-link"
                                  >1</a
                                >
                              </li>
                              <li class="paginate_button page-item">
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="2"
                                  tabindex="0"
                                  class="page-link"
                                  >2</a
                                >
                              </li>
                              <li class="paginate_button page-item">
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="3"
                                  tabindex="0"
                                  class="page-link"
                                  >3</a
                                >
                              </li>
                              <li class="paginate_button page-item">
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="4"
                                  tabindex="0"
                                  class="page-link"
                                  >4</a
                                >
                              </li>
                              <li class="paginate_button page-item">
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="5"
                                  tabindex="0"
                                  class="page-link"
                                  >5</a
                                >
                              </li>
                              <li
                                class="paginate_button page-item next"
                                id="basic-datatable_next"
                              >
                                <a
                                  href="#"
                                  aria-controls="basic-datatable"
                                  data-dt-idx="6"
                                  tabindex="0"
                                  class="page-link"
                                  >Next</a
                                >
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Filter Modal -->
          <div
            class="modal fade"
            id="filterModal"
            tabindex="-1"
            aria-labelledby="filterModalLabel"
            aria-hidden="true">
            
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="filterModalLabel">Filters</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <select
                        id="statusFilter"
                        class="form-control form-control-md"
                      >
                        <option value="">All Statuses</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <select
                        id="managerFilter"
                        class="form-control form-control-md"
                      >
                        <option value="">All Managers</option>
                      </select>
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <select id="clientFilter" class="form-control select2-show-search form-select select2-hidden-accessible form-control-sm" data-placeholder="Choose client" aria-hidden="true">
                        <option value="">All Clients</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <select id="productFilter" class="form-control select2-show-search form-select select2-hidden-accessible form-control-sm" data-placeholder="Choose product" aria-hidden="true">
                        <option value="">All Products</option>
                      </select>
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <input
                        type="date"
                        id="receivedDateFromFilter"
                        class="form-control form-control-md"
                        placeholder="Date From"
                      />
                    </div>
                    <div class="col-md-6">
                      <input
                        type="date"
                        id="receivedDateToFilter"
                        class="form-control form-control-md"
                        placeholder="Date To"
                      />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <select
                        id="DivisonFilter"
                        class="form-control form-control-md"
                      >
                        <option value="">Divison</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="clearFiltersButton"
                  >
                    Clear Filters
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary ms-auto"
                    id="applyFiltersButton"
                  >
                    Apply Filters
                  </button>
                </div>
              </div>
            </div>
          </div>
        

         

          <!-- FOOTER -->
          <footer class="footer">
            <div class="container">
              <div class="row align-items-center flex-row-reverse">
                <div class="col-md-12 col-sm-12 text-center">
                  Copyright © <span id="year"></span> Global Monarch F.Z.C.
                  Designed with <span class="fa fa-heart text-danger"></span> by
                  <a href="javascript:void(0)"> GM-EU</a> All rights reserved.
                </div>
              </div>
            </div>
          </footer>
          <!-- FOOTER CLOSED -->
        </div>

        <!-- BACK-TO-TOP -->
        <a href=" {% static '#top' %} " id="back-to-top"
          ><i class="fa fa-angle-up"></i
        ></a>

        <!-- JQUERY JS -->
        <script src=" {% static '/assets/js/jquery.min.js' %} "></script>

        <!-- BOOTSTRAP JS -->
        <script src=" {% static '/assets/plugins/bootstrap/js/popper.min.js' %} "></script>
        <script src=" {% static '/assets/plugins/bootstrap/js/bootstrap.min.js' %} "></script>

        <!-- SPARKLINE JS-->
        <script src=" {% static '/assets/js/jquery.sparkline.min.js' %} "></script>

        <!-- Select2 js-->
        <script src=" {% static '/assets/plugins/select2/select2.full.min.js' %} "></script>

        <!-- TypeHead js -->
        <script src=" {% static '/assets/plugins/bootstrap5-typehead/autocomplete.js' %} "></script>
        <script src=" {% static '/assets/js/typehead.js' %} "></script>

        <!-- INTERNAL Edit-Table JS -->
        <script src=" {% static '/assets/plugins/edit-table/bst-edittable.js' %} "></script>
        <script src=" {% static '/assets/plugins/edit-table/edit-table.js' %} "></script>

        <!-- Perfect SCROLLBAR JS-->
        <script src=" {% static '/assets/plugins/p-scroll/perfect-scrollbar.js' %} "></script>
        <script src=" {% static '/assets/plugins/p-scroll/pscroll.js' %} "></script>
        <script src=" {% static '/assets/plugins/p-scroll/pscroll-1.js' %} "></script>

        <!-- SIDE-MENU JS -->
        <script src=" {% static '/assets/plugins/sidemenu/sidemenu.js' %} "></script>

        <!-- SIDEBAR JS -->
        <script src=" {% static '/assets/plugins/sidebar/sidebar.js' %} "></script>

        <!-- Color Theme js -->
        <script src=" {% static '/assets/js/themeColors.js' %} "></script>

        <!-- Sticky js -->
        <script src=" {% static '/assets/js/sticky.js' %} "></script>

        <!-- CUSTOM JS -->
        <script src=" {% static '/assets/js/custom.js' %} "></script>

        <!-- Custom-switcher -->
        <script src=" {% static '/assets/js/custom-swicher.js' %} "></script>

        <!-- Switcher js -->
        <script src=" {% static '/assets/switcher/js/switcher.js' %} "></script>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
            let currentPage = 1;
            let pageSize = 10;

            function fetchEnquiries(page = 1, size = 10) {
              const searchQuery = document.getElementById("tableSearch").value;
              const statusFilter =
                document.getElementById("statusFilter").value;
              const managerFilter =
                document.getElementById("managerFilter").value;
              const clientFilter =
                document.getElementById("clientFilter").value;
              const productFilter =
                document.getElementById("productFilter").value;
              const receivedDateFromFilter = document.getElementById(
                "receivedDateFromFilter"
              ).value;
              const receivedDateToFilter = document.getElementById(
                "receivedDateToFilter"
              ).value;

              let url = `/api/enquiries/?page=${page}&page_size=${size}`;
              if (searchQuery) url += `&search=${searchQuery}`;
              if (statusFilter) url += `&status=${statusFilter}`;
              if (managerFilter) url += `&manager=${managerFilter}`;
              if (clientFilter) url += `&client=${clientFilter}`;
              if (productFilter) url += `&product=${productFilter}`;
              if (receivedDateFromFilter)
                url += `&received_date_from=${receivedDateFromFilter}`;
              if (receivedDateToFilter)
                url += `&received_date_to=${receivedDateToFilter}`;

              fetch(url)
                .then((response) => response.json())
                .then((data) => {
                  data.enquiries.sort(
                    (a, b) =>
                      new Date(b.received_date) - new Date(a.received_date)
                  );
                  populateTable(data.enquiries);
                  updatePagination(data.page, data.pages);
                })
                .catch((error) =>
                  console.error("Error fetching enquiries:", error)
                );
            }

            function populateTable(enquiries) {
              const tableBody = document.querySelector(
                "#basic-datatable tbody"
              );
              tableBody.innerHTML = "";

              enquiries.forEach((enquiry) => {
                const row = tableBody.insertRow();
                row.setAttribute("data-enquiry-id", enquiry.id);

                const productsText = enquiry.enquiry_requests
                  .map((request) => {
                    return request.product_name
                      ? request.product_name
                      : "Unknown Product";
                  })
                  .join(", ");

                const cellsData = [
                  enquiry.id,
                  enquiry.status || "N/A",
                  enquiry.manager || "N/A",
                  enquiry.client ? enquiry.client.name : "N/A",
                  productsText,
                  enquiry.received_date || "N/A",
                  enquiry.enquiry_requests
                    .map((request) => request.quantity)
                    .join(", "),
                ];

                cellsData.forEach((text) => {
                  const cell = row.insertCell();
                  cell.textContent = text;
                });

                row.addEventListener("click", function () {
                  window.location.href = `/enquiry/${enquiry.id}`;
                });
              });
            }

            function updatePagination(currentPage, totalPages) {
              const pagination = document.querySelector(
                "#basic-datatable_paginate .pagination"
              );
              pagination.innerHTML = "";

              const createPageItem = (page, text) => {
                const li = document.createElement("li");
                li.classList.add("paginate_button", "page-item");
                if (page === currentPage) {
                  li.classList.add("active");
                }
                const a = document.createElement("a");
                a.classList.add("page-link");
                a.href = "#";
                a.textContent = text;
                a.addEventListener("click", (event) => {
                  event.preventDefault();
                  currentPage = page; // Update the current page
                  fetchEnquiries(page, pageSize);
                });
                li.appendChild(a);
                return li;
              };

              if (currentPage > 1) {
                pagination.appendChild(
                  createPageItem(currentPage - 1, "Previous")
                );
              }

              for (let page = 1; page <= totalPages; page++) {
                pagination.appendChild(createPageItem(page, page));
              }

              if (currentPage < totalPages) {
                pagination.appendChild(createPageItem(currentPage + 1, "Next"));
              }
            }

            function populateFilters() {
              fetch("/api/filter-values/")
                .then((response) => response.json())
                .then((data) => {
                  const statusFilter = $("#statusFilter");
                  const managerFilter = $("#managerFilter");
                  const clientFilter = $("#clientFilter");
                  const productFilter = $("#productFilter");

                  statusFilter
                    .empty()
                    .append('<option value="">All Statuses</option>');
                  managerFilter
                    .empty()
                    .append('<option value="">All Managers</option>');
                  clientFilter
                    .empty()
                    .append('<option value="">All Clients</option>');
                  productFilter
                    .empty()
                    .append('<option value="">All Products</option>');

                  data.statuses.forEach((status) => {
                    statusFilter.append(new Option(status, status));
                  });

                  data.managers.forEach((manager) => {
                    managerFilter.append(new Option(manager, manager));
                  });

                  data.clients.forEach((client) => {
                    clientFilter.append(new Option(client, client));
                  });

                  data.products.forEach((product) => {
                    productFilter.append(new Option(product, product));
                  });
                })
                .catch((error) =>
                  console.error("Error fetching filter values:", error)
                );
            }

            $('.select2-show-search').select2({
                  dropdownParent: $('#filterModal'), // Ensure dropdown is appended to the modal
                  width: '100%',
                  tags: true,
                  minimumInputLength: 1,
                  placeholder: "Select suppliers",
                  createTag: function(params) {
                      var term = $.trim(params.term);
                      if (term === '') {
                          return null;
                      }
                      var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                      var exists = $('.select2-show-search').find('option').filter(function() {
                          return $(this).text().toLowerCase() === normalizedTerm;
                      }).length > 0;
                      if (exists) {
                          return null;
                      }
                      return {
                          id: term,
                          text: term,
                          newTag: true
                      };
                  }
              }).on('select2:select', function(e) {
                  if (e.params.data.newTag) {
                      console.log("New option added:", e.params.data.text);
                      // Additional logic for new tags can be implemented here
                  }
              });
            document
              .getElementById("entries-per-page")
              .addEventListener("change", function (event) {
                pageSize = parseInt(event.target.value, 10);
                fetchEnquiries(currentPage, pageSize); // Fetch data with the current page and new page size
              });

            document
              .getElementById("applyFiltersButton")
              .addEventListener("click", function () {
                fetchEnquiries(currentPage, pageSize);
                $("#filterModal").modal("hide");
              });

            document
              .getElementById("clearFiltersButton")
              .addEventListener("click", function () {
                document.getElementById("statusFilter").value = "";
                document.getElementById("managerFilter").value = "";
                document.getElementById("clientFilter").value = "";
                document.getElementById("productFilter").value = "";
                document.getElementById("receivedDateFromFilter").value = "";
                document.getElementById("receivedDateToFilter").value = "";
                fetchEnquiries(currentPage, pageSize);
              });

            document
              .getElementById("tableSearch")
              .addEventListener("keyup", function () {
                fetchEnquiries(currentPage, pageSize);
              });

            document
              .getElementById("openFiltersButton")
              .addEventListener("click", function () {
                $("#filterModal").modal("show");
                populateFilters(); // Populate filters when the modal is opened
              });

            fetchEnquiries(currentPage, pageSize);
            populateFilters(); // Populate filters on page load
          });
        </script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      document.querySelector(".search-input").addEventListener("keyup", function () {
          const value = this.value.toLowerCase().replace(/\s+/g, "");
          if (value) {
              fetch(`/search/?query=${value}`)
                  .then(response => response.json())
                  .then(data => {
                      if (data.results) {
                          const tbody = document.querySelector("#basic-datatable tbody");
                          tbody.innerHTML = '';
                          data.results.forEach(result => {
                              const row = document.createElement('tr');
                              row.innerHTML = `
                                  <td>${result.id}</td>
                                  <td>${result.status}</td>
                                  <td>${result.manager}</td>
                                  <td>${result.client}</td>
                                  <td>${result.products.join(', ')}</td>
                                  <td>${result.received_date}</td>
                                  <td>${result.quantity}</td>
                              `;
                              tbody.appendChild(row);
                          });
                      }
                  })
                  .catch(error => console.error('Error:', error));
          }
      });
  });
  </script>
      </div>
    </div>
  </body>
</html>
