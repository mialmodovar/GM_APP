<!doctype html>
<html lang="en" dir="ltr" style="--primary-rgb: 28,103,147;">

<head>
    {% load static %}
    <!-- META DATA -->
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sash â€“ Bootstrap 5  Admin & Dashboard Template">
    <meta name="author" content="Spruko Technologies Private Limited">
    <meta name="keywords" content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit.">

    <!-- FAVICON -->
    <link rel="shortcut icon" type="image/x-icon" href=" {% static '/assets/images/brand/favicon.ico' %} ">

    <!-- TITLE -->
    <title>Global Monarch</title>

    <!-- BOOTSTRAP CSS -->
    <link id="style" href=" {% static '/assets/plugins/bootstrap/css/bootstrap.min.css' %} " rel="stylesheet">

    <!-- STYLE CSS -->
     <link href=" {% static '/assets/css/style.css' %} " rel="stylesheet">

	<!-- Plugins CSS -->
    <link href=" {% static '/assets/css/plugins.css' %} " rel="stylesheet">

    <!--- FONT-ICONS CSS -->
    <link href=" {% static '/assets/css/icons.css' %} " rel="stylesheet">

    <!-- INTERNAL Switcher css -->
    <link href=" {% static '/assets/switcher/css/switcher.css' %} " rel="stylesheet">
    <link href=" {% static '/assets/switcher/demo.css' %} " rel="stylesheet">

    
</head>

<body class="app sidebar-mini ltr light-mode">

    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src=" {% static '/assets/images/loader.gif' %} " class="loader-img" alt="Loader">
    </div>
    <!-- /GLOBAL-LOADER -->

    <!-- PAGE -->
    <div class="page">
        <div class="page-main">

            <!-- app-Header -->
            <div class="app-header header sticky">
                <div class="container-fluid main-container">
                    <div class="d-flex">
                        <a aria-label="Hide Sidebar" class="app-sidebar__toggle" data-bs-toggle="sidebar" href=" {% static 'javascript:void(0)' %} "></a>
                        <!-- sidebar-toggle-->
                        <a class="logo-horizontal " href=" {% static 'index.html' %} ">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>

                       
                        <div class="d-flex order-lg-2 ms-auto header-right-icons">
                            <!-- SEARCH -->
                            <button class="navbar-toggler navresponsive-toggler d-lg-none ms-auto" type="button"
                                data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent-4"
                                aria-controls="navbarSupportedContent-4" aria-expanded="false"
                                aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon fe fe-more-vertical"></span>
                            </button>
                            <div class="navbar navbar-collapse responsive-navbar p-0">
                                <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
                                    <div class="d-flex order-lg-2">
                                            
                                            <div class="dropdown  d-flex notifications">
                                                <a class="nav-link icon" data-bs-toggle="dropdown" aria-expanded="false"><i class="fe fe-bell"></i><span class=" pulse"></span>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                    <div class="drop-heading border-bottom">
                                                        <div class="d-flex">
                                                            <h6 class="mt-1 mb-0 fs-16 fw-semibold text-dark">Notifications
                                                            </h6>
                                                        </div>
                                                    </div>
                                                    <div class="notifications-menu ps">
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-primary brround box-shadow-primary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">New change made to enquiry of FM96 to Kumas
                                                                </h5>
                                                                <span class="notification-subtext">1 hour ago</span>
                                                            </div>
                                                        </a>
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-secondary brround box-shadow-secondary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">Enquiry deadline coming up</h5>
                                                                <span class="notification-subtext">2 hours ago</span>
                                                            </div>
                                                        </a>
                                                       
                                                    <div class="ps__rail-x" style="left: 0px; bottom: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div></div></div>
                                                    <div class="dropdown-divider m-0"></div>
                                                    <a href="notify-list.html" class="dropdown-item text-center p-3 text-muted">View all
                                                        Notification</a>
                                                </div>
                                            </div>
                                        <!-- SIDE-MENU -->
                                        <div class="dropdown d-flex profile-1">
                                            <a href=" {% static 'javascript:void(0)' %} " data-bs-toggle="dropdown" class="nav-link leading-none d-flex">
                                                <img src=" {% static '/assets/images/users/21.jpg' %} " alt="profile-user"
                                                    class="avatar  profile-user brround cover-image">
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                <div class="drop-heading">
                                                    <div class="text-center">
                                                        <h5 class="text-dark mb-0 fs-14 fw-semibold">{{request.user.username}}</h5>
                                                    </div>
                                                </div>
                                                <div class="dropdown-divider m-0"></div>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-user"></i> Profile
                                                </a>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-alert-circle"></i> Sign out
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /app-Header -->

            <!--APP-SIDEBAR-->
            <div class="sticky">
                <div class="app-sidebar__overlay" data-bs-toggle="sidebar"></div>
                <div class="app-sidebar">
                    <div class="side-header">
                        <a class="header-brand1" href="">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-white.png' %} " class="header-brand-img toggle-logo"
                                alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-dark.png' %} " class="header-brand-img light-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>
                        <!-- LOGO -->
                    </div>
                    <div class="main-sidemenu">
                        <div class="slide-left disabled" id="slide-left"><svg xmlns="http://www.w3.org/2000/svg"
                                fill="#7b8191" width="24" height="24" viewBox="0 0 24 24">
                                <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" />
                            </svg></div>
                        <ul class="side-menu">
                           
                            <li class="slide">
                                <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                        class="side-menu__icon fe fe-home"></i><span
                                        class="side-menu__label">Home</span></a>
                            </li>
                            <li class="slide">
                                <a class="side-menu__item has-link" data-bs-toggle="slide" href="/enquiry_list"><i
                                        class="side-menu__icon fe fe-send"></i><span
                                        class="side-menu__label">Enquiries</span></a>
                            </li>
                            <li class="slide">
                                <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                        class="side-menu__icon fe fe-pie-chart"></i><span
                                        class="side-menu__label">Create new Enquiry</span></a>
                            </li>
                            <li class="slide">
                                <a class="side-menu__item has-link" data-bs-toggle="slide" href="/supplier_list"><i
                                        class="side-menu__icon fe fe-activity"></i><span
                                        class="side-menu__label">Supplier Management</span></a>
                            </li>

                        </ul>
                        <div class="slide-right" id="slide-right"><svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191"
                                width="24" height="24" viewBox="0 0 24 24">
                                <path d="M10.707 17.707 16.414 12l-5.707-5.707-1.414 1.414L13.586 12l-4.293 4.293z" />
                            </svg></div>
                    </div>
                </div>
            </div>
            <!--/APP-SIDEBAR-->
<!--app-content open-->
<div class="main-content app-content mt-0">
    <div class="side-app">

        <!-- CONTAINER -->
        <div class="main-container container-fluid">

            <!-- PAGE-HEADER -->
            <div class="page-header">
                <h1 class="page-title">Enquiry Management</h1>
                <div>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href=" {% static 'javascript:void(0)' %} ">Pages</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Empty</li>
                    </ol>
                </div>
            </div>
            <!-- PAGE-HEADER END -->
            <div class="row ">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Enquiry Information</div>
                        <div class="card-options">
                            
                                <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Tender Documents
                                        <span class="caret"></span>
                                    </button>
                                <ul class="dropdown-menu" style="">
                                    {% for attachment in enquiry.attachments.all %}
                                    <li><a href="{{ attachment.file.url }}" download>{{ attachment.file.name}}</a></li>
                                {% endfor %}
                              
                                    <li class="divider"></li>
                                    <li><a href="javascript:void(0)">Attach Item</a></li>
                                </ul>
                            
                                
                            </div>
                        </div>
                            
                        
                    
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-2">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div>
                                            <label>Status</label>
                                            <select name="status" class="form-control form-select select2 select2-hidden-accessible" data-bs-placeholder="Select Status" tabindex="-1" aria-hidden="true">
                                                <option value="ACTIVE" {% if enquiry.status == 'ACTIVE' %}selected{% endif %}>ACTIVE</option>
                                                <option value="CLOSED" {% if enquiry.status == 'CLOSED' %}selected{% endif %}>CLOSED</option>
                                                <option value="ORDER" {% if enquiry.status == 'ORDER' %}selected{% endif %}>ORDER</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <label>Manager</label>
                                        <input type="text" class="form-control"  id = "manager" value="{{ enquiry.manager.name }}" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <label>Client</label>
                                     <input type="text" class="form-control"  value="{{ enquiry.client.name }}" readonly> 
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 mt-2 mt-md-0">
                                <label>Received Date</label>
                                <div class="input-group">
                                    <div class="input-group-text">
                                        <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                    </div>
                                    <input class="form-control" id = 'received_date' placeholder="YYYY/MM/DD" type="date" value="{{ enquiry.received_date|date:"Y-m-d" }}" >
                                </div>
                            </div>
                            <div class="col-md-2 mt-2 mt-md-0">
                                <label>Deadline</label>
                                <div class="input-group">
                                    <div class="input-group-text">
                                        <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                    </div>
                                    <input class="form-control" id = 'submission_deadline' placeholder="YYYY/MM/DD" type="date" value="{{ enquiry.submission_deadline|date:"Y-m-d" }}" >
                                </div>
                            </div>
                            <div class="col-md-2 mt-2 mt-md-0">
                                <label>Submission Date</label>
                                <div class="input-group">
                                    <div class="input-group-text">
                                        <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                    </div>
                                    <input class="form-control" id = 'submission_date' placeholder="YYYY/MM/DD" type="date" value="{{ enquiry.submission_date|date:"Y-m-d" }}" >
                                </div>
                            </div>
                            <div id="requests-table"></div>
                          
                        </div>
                        
                          
                        </div>
                    </div>
            </div>
            </div>
                
            
      <!-- CONTAINER CLOSED -->
 
    <div class="row">
        <div class="col-lg-12">
            <div id="tables-container" class="mt-4"></div>
        </div>
    </div>



    </div>
</div>
<!--app-content closed-->
</div>

 <!-- Sidebar-right -->
 <div class="sidebar sidebar-right sidebar-animate">
    <div class="panel panel-primary card mb-0 shadow-none border-0">
        <div class="tab-menu-heading border-0 d-flex p-3">
            <div class="card-title mb-0"><i class="fe fe-bell me-2"></i><span
                    class=" pulse"></span>Notifications</div>
            <div class="card-options ms-auto">
                <a href=" {% static 'javascript:void(0);' %} " class="sidebar-icon text-end float-end me-3 mb-1"
                    data-bs-toggle="sidebar-right" data-target=".sidebar-right"><i
                        class="fe fe-x text-white"></i></a>
            </div>
        </div>
        <div class="panel-body tabs-menu-body latest-tasks p-0 border-0">
            <div class="tabs-menu border-bottom">
                <!-- Tabs -->
                <ul class="nav panel-tabs">
                    <li class=""><a href=" {% static '#sidebar-side1' %} " class="active" data-bs-toggle="tab"><i
                                class="fe fe-settings me-1"></i>Feeds</a></li>
                    <li><a href=" {% static '#sidebar-side2' %} " data-bs-toggle="tab"><i class="fe fe-message-circle me-1"></i> Chat</a></li>
                    <li><a href=" {% static '#sidebar-side3' %} " data-bs-toggle="tab"><i class="fe fe-anchor me-1"></i>Timeline</a></li>
                </ul>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="sidebar-side1">
                    <div class="p-3 fw-semibold ps-5">Feeds</div>
                    <div class="card-body pt-2">
                        <div class="browser-stats">
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span class="feeds avatar-circle brround bg-primary-transparent"><i
                                            class="fe fe-user text-primary"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">New user registered</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-secondary brround bg-secondary-transparent"><i
                                            class="fe fe-shopping-cart text-secondary"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">New order delivered</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-danger brround bg-danger-transparent"><i
                                            class="fe fe-bell text-danger"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">You have pending tasks</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-warning brround bg-warning-transparent"><i
                                            class="fe fe-gitlab text-warning"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">New version arrived</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-pink brround bg-pink-transparent"><i
                                            class="fe fe-database text-pink"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">Server #1 overloaded</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-info brround bg-info-transparent"><i
                                            class="fe fe-check-circle text-info"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">New project launched</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-x"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 fw-semibold ps-5">Settings</div>
                    <div class="card-body pt-2">
                        <div class="browser-stats">
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span class="feeds avatar-circle brround bg-primary-transparent"><i
                                            class="fe fe-settings text-primary"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">General Settings</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-secondary brround bg-secondary-transparent"><i
                                            class="fe fe-map-pin text-secondary"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">Map Settings</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-danger brround bg-danger-transparent"><i
                                            class="fe fe-headphones text-danger"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">Support Settings</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-warning brround bg-warning-transparent"><i
                                            class="fe fe-credit-card text-warning"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">Payment Settings</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-sm-2 mb-sm-0 mb-3">
                                    <span
                                        class="feeds avatar-circle avatar-circle-pink brround bg-pink-transparent"><i
                                            class="fe fe-bell text-pink"></i></span>
                                </div>
                                <div class="col-sm-10 ps-sm-0">
                                    <div class="d-flex align-items-end justify-content-between ms-2">
                                        <h6 class="">Notification Settings</h6>
                                        <div>
                                            <a href=" {% static 'javascript:void(0)' %} "><i class="fe fe-settings me-1"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="sidebar-side2">
                    <div class="list-group list-group-flush">
                        <div class="pt-3 fw-semibold ps-5">Today</div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/2.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Addie Minstra</div>
                                    <p class="mb-0 fs-12 text-muted"> Hey! there I' am available </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/11.jpg' %} "><span
                                        class="avatar-status bg-success"></span></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Rose Bush</div>
                                    <p class="mb-0 fs-12 text-muted"> Okay.I will be waiting for you </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/10.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Claude Strophobia</div>
                                    <p class="mb-0 fs-12 text-muted"> Hi we can explain our new project
                                    </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/13.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Eileen Dover</div>
                                    <p class="mb-0 fs-12 text-muted"> New product Launching. </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/12.jpg' %} "><span
                                        class="avatar-status bg-success"></span></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Willie Findit</div>
                                    <p class="mb-0 fs-12 text-muted"> Okay.I will be waiting for you </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/15.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Manny Jah</div>
                                    <p class="mb-0 fs-12 text-muted"> Hi we can explain our new project
                                    </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/4.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Cherry Blossom</div>
                                    <p class="mb-0 fs-12 text-muted"> Hey! there I' am available</p>
                                </a>
                            </div>
                        </div>
                        <div class="pt-3 fw-semibold ps-5">Yesterday</div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/7.jpg' %} "><span
                                        class="avatar-status bg-success"></span></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Simon Sais</div>
                                    <p class="mb-0 fs-12 text-muted">Schedule Realease </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/9.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Laura Biding</div>
                                    <p class="mb-0 fs-12 text-muted"> Hi we can explain our new project
                                    </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/2.jpg' %} "><span
                                        class="avatar-status bg-success"></span></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Addie Minstra</div>
                                    <p class="mb-0 fs-12 text-muted">Contact me for details</p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/9.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Ivan Notheridiya</div>
                                    <p class="mb-0 fs-12 text-muted"> Hi we can explain our new project
                                    </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/14.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Dulcie Veeta</div>
                                    <p class="mb-0 fs-12 text-muted"> Okay.I will be waiting for you </p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/11.jpg' %} "></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Florinda Carasco</div>
                                    <p class="mb-0 fs-12 text-muted">New product Launching.</p>
                                </a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <div class="me-2">
                                <span class="avatar avatar-md brround cover-image"
                                    data-bs-image-src=" {% static '/assets/images/users/4.jpg' %} "><span
                                        class="avatar-status bg-success"></span></span>
                            </div>
                            <div class="">
                                <a href=" {% static 'chat.html' %} ">
                                    <div class="fw-semibold text-dark" data-bs-toggle="modal"
                                        data-target="#chatmodel">Cherry Blossom</div>
                                    <p class="mb-0 fs-12 text-muted">cherryblossom@gmail.com</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="sidebar-side3">
                    <ul class="task-list timeline-task">
                        <li class="d-sm-flex mt-4">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">Task Finished<span
                                        class="text-muted fs-11 mx-2 fw-normal">09 July 2021</span></h6>
                                <p class="text-muted fs-12">Adam Berry finished task on<a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> Project Management</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                        <li class="d-sm-flex">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">New Comment<span
                                        class="text-muted fs-11 mx-2 fw-normal">05 July 2021</span></h6>
                                <p class="text-muted fs-12">Victoria commented on Project <a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> AngularJS Template</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                        <li class="d-sm-flex">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">New Comment<span
                                        class="text-muted fs-11 mx-2 fw-normal">25 June 2021</span></h6>
                                <p class="text-muted fs-12">Victoria commented on Project <a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> AngularJS Template</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                        <li class="d-sm-flex">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">Task Overdue<span
                                        class="text-muted fs-11 mx-2 fw-normal">14 June 2021</span></h6>
                                <p class="text-muted mb-0 fs-12">Petey Cruiser finished task <a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> Integrated management</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                        <li class="d-sm-flex">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">Task Overdue<span
                                        class="text-muted fs-11 mx-2 fw-normal">29 June 2021</span></h6>
                                <p class="text-muted mb-0 fs-12">Petey Cruiser finished task <a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> Integrated management</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                        <li class="d-sm-flex">
                            <div>
                                <i class="task-icon1"></i>
                                <h6 class="fw-semibold">Task Finished<span
                                        class="text-muted fs-11 mx-2 fw-normal">09 July 2021</span></h6>
                                <p class="text-muted fs-12">Adam Berry finished task on<a href=" {% static 'javascript:void(0)' %} "
                                        class="fw-semibold"> Project Management</a></p>
                            </div>
                            <div class="ms-auto d-md-flex me-3">
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted me-2"><span class="fe fe-edit"></span></a>
                                <a href=" {% static 'javascript:void(0)' %} " class="text-muted"><span class="fe fe-trash-2"></span></a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--/Sidebar-right-->

<!-- Country-selector modal-->
<div class="modal fade" id="country-selector">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content country-select-modal">
            <div class="modal-header">
                <h6 class="modal-title">Choose Country</h6><button aria-label="Close" class="btn-close"
                    data-bs-dismiss="modal" type="button"><span aria-hidden="true">Ã—</span></button>
            </div>
            <div class="modal-body">
                <ul class="row p-3">
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block active">
                            <span class="country-selector"><img alt="" src=" {% static '/assets/images/flags-img/us_flag.jpg' %} "
                                    class="me-3 language"></span>USA
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/italy_flag.jpg' %} "
                                class="me-3 language"></span>Italy
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/spain_flag.jpg' %} "
                                class="me-3 language"></span>Spain
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/india_flag.jpg' %} "
                                class="me-3 language"></span>India
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/french_flag.jpg' %} "
                                class="me-3 language"></span>French
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/russia_flag.jpg' %} "
                                class="me-3 language"></span>Russia
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/germany_flag.jpg' %} "
                                class="me-3 language"></span>Germany
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt=""
                                src=" {% static '/assets/images/flags-img/argentina.jpg' %} "
                                class="me-3 language"></span>Argentin
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt="" src=" {% static '/assets/images/flags-img/malaysia.jpg' %} "
                                class="me-3 language"></span>Malaysia
                        </a>
                    </li>
                    <li class="col-lg-6 mb-2">
                        <a href=" {% static 'javascript:void(0)' %} " class="btn btn-country btn-lg btn-block">
                            <span class="country-selector"><img alt="" src=" {% static '/assets/images/flags-img/turkey.jpg' %} "
                                class="me-3 language"></span>Turkey
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- Country-selector modal-->

<!-- FOOTER -->
<footer class="footer">
    <div class="container">
        <div class="row align-items-center flex-row-reverse">
            <div class="col-md-12 col-sm-12 text-center">
                Copyright Â© <span id="year"></span> Global Monarch F.Z.C. Designed with <span class="fa fa-heart text-danger"></span> by <a href="javascript:void(0)"> GM-EU</a> All rights reserved.
            </div>
        </div>
    </div>
</footer>
<!-- FOOTER CLOSED -->
</div>

<!-- BACK-TO-TOP -->
<a href=" {% static '#top' %} " id="back-to-top"><i class="fa fa-angle-up"></i></a>

   <!-- JQUERY JS -->
   <script src=" {% static '/assets/js/jquery.min.js' %} "></script>

           <!-- Toastr CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


   <!-- BOOTSTRAP JS -->
   <script src=" {% static '/assets/plugins/bootstrap/js/popper.min.js' %} "></script>
   <script src=" {% static '/assets/plugins/bootstrap/js/bootstrap.min.js' %} "></script>

   <!-- SPARKLINE JS-->
   <script src=" {% static '/assets/js/jquery.sparkline.min.js' %} "></script>


      <!-- INTERNAL Bootstrap-Datepicker js-->
    <script src=" {% static '/assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %} "></script>

    <!-- BOOTSTRAP-DATERANGEPICKER JS -->
    <script src=" {% static '/assets/plugins/bootstrap-daterangepicker/moment.min.js' %} "></script>

    <!-- INTERNAL Bootstrap-Datepicker js-->
    <script src=" {% static '/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js' %} "></script>

   <!-- TypeHead js -->
   <script src=" {% static '/assets/plugins/bootstrap5-typehead/autocomplete.js' %} "></script>
   <script src=" {% static '/assets/js/typehead.js' %} "></script>

     <!-- SELECT2 JS -->
     <script src=" {% static '/assets/plugins/select2/select2.full.min.js' %} "></script>
     <script src=" {% static '/assets/js/select2.js' %} "></script>

   <!-- INTERNAL Edit-Table JS -->
   <script src=" {% static '/assets/plugins/edit-table/bst-edittable.js' %} "></script>
   <script src=" {% static '/assets/plugins/edit-table/edit-table.js' %} "></script>


   <!-- Perfect SCROLLBAR JS-->
   <script src=" {% static '/assets/plugins/p-scroll/perfect-scrollbar.js' %} "></script>
   <script src=" {% static '/assets/plugins/p-scroll/pscroll.js' %} "></script>
   <script src=" {% static '/assets/plugins/p-scroll/pscroll-1.js' %} "></script>

   <!-- SIDE-MENU JS -->
   <script src=" {% static '/assets/plugins/sidemenu/sidemenu.js' %} "></script>

   <!-- SIDEBAR JS -->
   <script src=" {% static '/assets/plugins/sidebar/sidebar.js' %} "></script>

   <!-- Color Theme js -->
   <script src=" {% static '/assets/js/themeColors.js' %} "></script>

   <!-- Sticky js -->
   <script src=" {% static '/assets/js/sticky.js' %} "></script>

   <!-- CUSTOM JS -->
   <script src=" {% static '/assets/js/custom.js' %} "></script>

   <!-- Custom-switcher -->
   <script src=" {% static '/assets/js/custom-swicher.js' %} "></script>

   <!-- Switcher js -->
   <script src="{% static '/assets/switcher/js/switcher.js' %} "></script>




<!-- Modal HTML -->
    <!-- Select2 modal -->
<!-- Modal HTML -->
<div class="modal fade" id="supplierDetailModal"  role="dialog" aria-labelledby="supplierDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplierDetailModalLabel">Supplier Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">x</button>
            </div>
            <div class="modal-body" id="supplier-details-content">
       
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-danger" id="delete-row">Delete Row</button>
                <button type="button" class="btn btn-primary" id="confirm-supplier-selection">Confirm</button>
            </div>
        </div>
    </div>
</div>


<!-- Supplier Modal HTML -->
<div class="modal fade" id="supplierDetailModalClient" role="dialog" aria-labelledby="supplierDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplierDetailModalLabel">Supplier Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">x</button>
            </div>
            <div class="modal-body" id="supplier-client-details-content">
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-danger" id="delete-supplier-row">Delete Row</button>
                <button type="button" class="btn btn-primary" id="confirm-client-supplier-selection">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Product Modal HTML -->
<div class="modal fade" id="productDetailModal" role="dialog" aria-labelledby="productDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productDetailModalLabel">Product Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">x</button>
            </div>
            <div class="modal-body" id="product-details-content">
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-danger" id="delete-product-row">Delete Row</button>
                <button type="button" class="btn btn-primary" id="confirm-product-selection">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Delivery Schedule Modal HTML -->
<div class="modal fade" id="templateModal" tabindex="-1" role="dialog" aria-labelledby="templateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="templateModalLabel">Delivery Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="multipleDeliveriesTableContainer" class="table-responsive">
                    <table class="table border text-nowrap text-md-nowrap table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Quantity</th>
                                <th>Sizes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="multipleDeliveriesTableBody">
                            <!-- Rows will be populated here -->
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-primary btn-sm mt-2 add-row-button">Add Row</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary save-changes-button">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">x</button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this row?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-row">Delete</button>
            </div>
        </div>
    </div>
</div>
  
<!-- Function to build requests/offers table -->
   <script>

var enquiryId = '{{ enquiry.id }}'; // Ensure enquiryId is dynamically set

$.ajax({
    url: `/enquiry/${enquiryId}/requests_offers`, // Adjust URL as needed
    type: 'GET',
    dataType: 'json',
    success: function(data) {
        var requestsTableHtml = generateRequestsOverviewTable(data);
        console.log(data)
        // Append the requests overview table to the "requests-table" div
        $('#requests-table').html(requestsTableHtml);

        data.forEach(function(request) {
            // Dynamically set titles based on request data
            var requestCardTitle = request.product || "Not Specified";

            // Initialize the HTML for the parent card
            var parentCardHtml = `
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Details for ${requestCardTitle}</h3>
                </div>
                <div class="card-body">`;

            // Generate HTML for supplier offers card
            var supplierOffersCardHtml = generateSupplierOffersCardHtml(request, `${requestCardTitle} - Supplier Offers`);

            // Generate HTML for offers sent to clients card
            var clientOffersCardHtml = generateClientOffersCardHtml(request, `${requestCardTitle} - Offers Sent to Clients`);

            // Close the parent card HTML
            parentCardHtml += supplierOffersCardHtml + clientOffersCardHtml + `</div></div>`;

            // Append the combined parent card to the tables-container div
            $('#tables-container').append(parentCardHtml);

            // Call mergeTableCells after the content is appended
            var requestsTable = document.getElementById(`requests`);
            if (requestsTable) {
                sortTableRows(requestsTable);
                mergeTableCells(requestsTable);
            }
            // Call mergeTableCells after the content is appended
            var supplierTable = document.getElementById(`offers-${request.id}`);
            if (supplierTable) {
                sortTableRows(supplierTable);
                mergeTableCells(supplierTable);
            }

            var clientTable = document.getElementById(`offers_clients-${request.id}`);
            if (clientTable) {
                sortTableRows(clientTable);
                mergeTableCells(clientTable);
            }
        });
    },
    error: function(jqXHR, textStatus, errorThrown) {
        console.error('Error fetching data:', textStatus, errorThrown);
    }
});

// Global object to store supplier names by request ID
var supplierNamesByRequestId = {};

// Function to generate HTML for supplier offers card
function generateSupplierOffersCardHtml(request, cardTitle) {
    var cardHtml = 
    `<div class="card">
        <div class="card-header">
            <h3 class="card-title">${request.product} - Offers received from suppliers</h3>
            <div class="card-options">
                <button type="button" class="btn btn-sm btn-secondary btn-add-offer" style="display:none;" data-target="offers-${request.id}">
                    <span class="fe fe-plus-circle"></span> Add new offer
                </button>
                <button type="button" class="btn btn-sm btn-success btn-save-offers" style="display:none;" data-target="offers-${request.id}">
                    <span class="fe fe-save save-offer"></span> Save All
                </button>
                <button type="button" class="btn btn-sm btn-info btn-add-checkboxes" data-table-id="offers-${request.id}">
                    <span class="fe fe-check-square"></span> Send emails
                </button>
                <button type="button" class="btn btn-sm btn-primary btn-edit-offers" data-target="offers-${request.id}">
                    <span class="fe fe-edit edit-offer"></span> Edit All
                </button>
                <button type="button" class="btn btn-sm btn-danger btn-cancel-emails" style="display:none;" data-table-id="offers-${request.id}">
                    <span class="fe fe-x"></span> Cancel
                </button>
                <button type="button" class="btn btn-sm btn-success btn-confirm-emails" style="display:none;" data-table-id="offers-${request.id}">
                    <span class="fe fe-check"></span> Confirm Send
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="offers-${request.id}" class="table table-bordered border text-nowrap mb-0">
                    <thead>
                        <tr>
                            <th>Supplier</th>
                            <th>Price</th>
                            <th>Payment Terms</th>
                            <th>Incoterms</th>
                            <th>Specs</th>
                            <th>Size</th>
                            <th>Packaging</th>
                            <th>Validity</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>`;
    
    // Initialize an array to store supplier names for this request ID
    supplierNamesByRequestId[request.id] = [];
    // Append each offer row
    if (request.offers && request.offers.length > 0) {
        request.offers.forEach(function(offer) {
            var emailStatusHtml = '';
            var relatedEmails = request.emails.filter(email => email.supplier_id === offer.supplier_id);

            if (relatedEmails.length > 0) {
                relatedEmails.forEach(function(email) {
                    var status = email.status.toLowerCase();
                    if (status === 'draft' || status === 'failed') {
                        emailStatusHtml = '&#x1F4E7; &#x274C;';
                    } else if (status === 'sent') {
                        emailStatusHtml = '&#x1F4E7; &#x2705;';
                    }
                });
            }
            // Store the supplier name
            supplierNamesByRequestId[request.id].push(offer.supplier);

            cardHtml += `<tr data-offer-id="${offer.id}" data-supplier-id="${offer.supplier_id}">
                <td class="noteditable" contenteditable="false" data-toggle="modal" data-target="#supplierDetailModal" data-supplier-id="${offer.supplier_id}"><a href="/supplier_detail/${offer.supplier_id}/">${offer.supplier}</a></td>
                <td contenteditable="false">${offer.supplier_price}</td>
                <td contenteditable="false">${offer.payment_terms}</td>
                <td contenteditable="false">${offer.incoterms}</td>
                <td contenteditable="false">${offer.specs}</td>
                <td contenteditable="false">${offer.size}</td>
                <td contenteditable="false">${offer.packaging}</td>
                <td class="validity-cell" contenteditable="false">${offer.validity}</td>
                <td contenteditable="false">${offer.notes}</td>
            </tr>`;
        });
    }
    cardHtml += `</tbody></table></div></div></div>`;
    return cardHtml;
}


// Function to generate HTML for offers sent to clients card
function generateClientOffersCardHtml(request, cardTitle) {
    var cardHtml = `
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">${request.product} - Offers sent to Client</h3>
        <div class="card-options">
            <button type="button" class="btn btn-sm btn-primary btn-edit-clientoffers" data-target="offers_clients-${request.id}">
                <span class="fe fe-edit edit-offer"></span> Edit All
            </button>
            <button type="button" class="btn btn-sm btn-secondary btn-add-clientoffers" style="display:none;" data-target="offers_clients-${request.id}">
                <span class="fe fe-plus-circle"></span> Add new offer
            </button>
            <button type="button" class="btn btn-sm btn-success btn-save-clientoffers" style="display:none;" data-target="offers_clients-${request.id}">
                <span class="fe fe-save save-offer"></span> Save All
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="offers_clients-${request.id}" class="table table-bordered border text-nowrap">
                <thead>
                    <tr>
                        <th>Supplier</th>
                        <th>Price Offered</th>
                        <th>Margin</th>
                        <th>Payment Term Offered</th>
                        <th>Incoterms</th>
                        <th>Valid until</th>
                        <th>Feedback</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>`;

    if (request.offers_client && request.offers_client.length > 0) {
        request.offers_client.forEach(function(offer) {
            // Append a new row to the table's tbody with the offer details
            cardHtml += `
            <tr data-offer-client-id="${offer.id}">
                <td class="editable-supplier" contenteditable="false" data-toggle="modal" data-target="#supplierDetailModalClient" data-supplier-id="${offer.supplier_id}"><a href="javascript:void(0);">${offer.supplier}</a></td>
                <td contenteditable="false">${offer.price_offered}</td>
                <td contenteditable="false">${offer.margin}</td>
                <td contenteditable="false">${offer.payment_term_offered}</td>
                <td contenteditable="false">${offer.incoterms}</td>
                <td class="validity-cell" contenteditable="false">${offer.validity_offered}</td>
                <td contenteditable="false">${offer.customer_feedback}</td>
                <td contenteditable="false">${offer.notes}</td>
            </tr>`;
        });
    }
    cardHtml += `</tbody></table></div></div></div>`;
    return cardHtml;
}

function generateRequestsOverviewTable(data) {
    var tableHtml = `
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Requests Overview</h3>
                <div class="card-options">
                    <button type="button" class="btn btn-sm btn-primary btn-edit-requests">
                        <span class="fe fe-edit edit-offer"></span> Edit All
                    </button>
                    <button type="button" class="btn btn-sm btn-secondary btn-add-requests" style="display:none;">
                        <span class="fe fe-plus-circle"></span> Add new request
                    </button>
                    <button type="button" class="btn btn-sm btn-success btn-save-requests" style="display:none;">
                        <span class="fe fe-save save-offer"></span> Save All
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="requests" class="table table-bordered border text-nowrap">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Unit</th>
                                <th>Specs</th>
                                <th>Size</th>
                                <th>Packaging</th>
                                <th>Payment Terms</th>
                                <th>Target Price</th>
                                <th>Incoterms</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>`;

                            data.forEach(function(request) {
                                var productName = request.product || "Not Specified";
                                var specs = request.specs || "";
                                var specsLink = specs.startsWith("http") ? 
                                    `<a href="${specs}" target="_blank" class="specs-link">View Specs</a>` : 
                                    `<a href="" class="specs-link" data-specs="${specs}" data-bs-toggle="modal" data-bs-target="#scrollingmodal">View Specs</a>`;
                                var deliveryScheduleModalId = `deliveryScheduleModal-${request.id}`;
                                var deliveryScheduleLink = `<a href="#" class="delivery-schedule-link" data-modal-id="${deliveryScheduleModalId}" data-delivery-schedule='${JSON.stringify(request.delivery_schedule)}' data-product-name="${productName}">View Delivery Schedule</a>`;
                                
                                tableHtml += `<tr data-request-id="${request.id}">
                                    <td class="product-noteditable">${productName}</td>
                                    <td class="quantity-field noteditable" data-product-name="${productName}" data-modal-id="${deliveryScheduleModalId}" data-delivery-schedule='${JSON.stringify(request.delivery_schedule)}'>${request.quantity}</td>
                                    <td>${request.quantity_unit}</td>
                                    <td>${specsLink}</td>
                                    <td>${request.size}</td>
                                    <td>${request.packaging}</td>
                                    <td>${request.payment_terms_requested}</td>
                                    <td>${request.target_price}</td>
                                    <td>${request.incoterms}</td>
                                    <td>${request.notes}</td>
                                </tr>`;
                            });

    tableHtml += `</tbody></table></div></div></div>`;
    return tableHtml;
}

// Function to populate the modal with delivery schedule data
function populateModal(deliverySchedule) {
    var tableBody = '';
    deliverySchedule.forEach(function(schedule, index) {
        tableBody += `
            <tr>
                <td><input type="date" class="form-control" value="${schedule.date}"></td>
                <td><input type="number" class="form-control delivery-quantity" value="${schedule.quantity}" placeholder="Enter quantity"></td>
                <td><input type="text" class="form-control delivery-notes" value="${schedule.notes}" placeholder="Enter sizes"></td>
                <td><button type="button" class="btn btn-danger btn-sm remove-row">Remove</button></td>
            </tr>`;
    });

    $('#multipleDeliveriesTableBody').html(tableBody);
}

// Event listener for quantity field click
$(document).on('click', '.quantity-field', function() {
    var deliverySchedule = $(this).data('delivery-schedule');
    var productName = $(this).data('product-name');

    $('#templateModalLabel').text(`Delivery Schedule for ${productName}`);

    // Populate the modal with the delivery schedule data
    populateModal(deliverySchedule);

      // Check if the table has the edit-mode-requests class
      if (!$('#requests').hasClass('edit-mode-requests')) {
        // Make inputs readonly and hide remove buttons
        $('#templateModal .delivery-quantity').attr('readonly', true);
        $('#templateModal .delivery-notes').attr('readonly', true);
        $('#templateModal input[type="date"]').attr('readonly', true);
        $('#templateModal .remove-row').hide();
        $('#templateModal .add-row-button').hide();
    } else {
        // Make inputs editable and show remove buttons
        $('#templateModal .delivery-quantity').attr('readonly', false);
        $('#templateModal .delivery-notes').attr('readonly', false);
        $('#templateModal input[type="date"]').attr('readonly', false);
        $('#templateModal .remove-row').show();
        $('#templateModal .add-row-button').show();
    }

    // Initialize the modal using Bootstrap's JavaScript API
    var myModal = new bootstrap.Modal(document.getElementById('templateModal'));
    myModal.show();
});

// Function to update quantity field
function updateQuantityField() {
    var totalQuantity = 0;
    $('#multipleDeliveriesTableBody .delivery-quantity').each(function() {
        var quantity = parseFloat($(this).val());
        if (!isNaN(quantity)) {
            totalQuantity += quantity;
        }
    });
    return totalQuantity;
}

// Event listeners for adding/removing rows and updating quantity
$(document).on('click', '.add-row-button', function() {
    var rowCount = $('#multipleDeliveriesTableBody tr').length + 1;
    var newRow = `<tr>
                    <td><input type="date" class="form-control"></td>
                    <td><input type="number" class="form-control delivery-quantity" placeholder="Enter quantity"></td>
                    <td><input type="text" class="form-control delivery-notes" placeholder="Enter sizes"></td>
                    <td><button type="button" class="btn btn-danger btn-sm remove-row">Remove</button></td>
                  </tr>`;
    $('#multipleDeliveriesTableBody').append(newRow);
});

$(document).on('click', '.remove-row', function() {
    $(this).closest('tr').remove();
  
});

$(document).on('input', '.delivery-quantity', function() {
    updateQuantityField();
});

// Event listener for saving changes
$(document).on('click', '.save-changes-button', function() {
    var modal = $('#templateModal');
    var productName = modal.find('.modal-title').text().replace('Delivery Schedule for ', '');
    var quantityField = $(`.quantity-field[data-product-name="${productName}"]`);
    var deliverySchedule = [];

    $('#multipleDeliveriesTableBody tr').each(function() {
        var row = {
            date: $(this).find('td').eq(0).find('input').val(),
            quantity: $(this).find('td').eq(1).find('input').val(),
            notes: $(this).find('td').eq(2).find('input').val()
        };
        deliverySchedule.push(row);
    });

    // Update the data-delivery-schedule attribute with the new data
    quantityField.data('delivery-schedule', deliverySchedule);

    if ($('#requests').hasClass('edit-mode-requests')) {
        // Update the quantity field
        var totalQuantity = updateQuantityField();
        quantityField.text(totalQuantity);
    }

    modal.modal('hide'); // Hide the modal
});



// HTML structure for scrolling modal
$('body').append(`
<div class="modal fade" id="scrollingmodal" tabindex="-1" aria-labelledby="scrollingmodalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scrollingmodalLabel">Specs Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Specs details will be inserted here -->
                <textarea id="modalSpecsBody" class="form-control" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary save-specs-button" style="display:none;">Save changes</button>
            </div>
        </div>
    </div>
</div>
`);

// Handle specs link click
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('specs-link')) {
        event.preventDefault();
        var specs = event.target.getAttribute('href') || event.target.getAttribute('data-specs') || "";
        var isLink = specs.startsWith("http://") || specs.startsWith("https://");
        console.log(specs);
        
        // Ensure the URL uses HTTPS
        if (specs.startsWith("http://")) {
            specs = specs.replace("http://", "https://");
        }

        if (isLink) {
            if (specs.endsWith(".pdf") || specs.endsWith(".jpeg") || specs.endsWith(".jpg") || specs.endsWith(".png")) {
                window.open(specs, '_blank');
            } else {
                // Force download
                var link = document.createElement('a');
                link.href = specs;
                link.download = '';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        } else {
            var modalSpecsBody = document.getElementById('modalSpecsBody');
            
            // Set the specs text directly
            modalSpecsBody.value = specs;

            // Check if the table has the edit-mode-requests class
            if ($('#requests').hasClass('edit-mode-requests')) {
                modalSpecsBody.removeAttribute('readonly');
                $('.save-specs-button').show();
            } else {
                modalSpecsBody.setAttribute('readonly', true);
                $('.save-specs-button').hide();
            }

            // Show the modal
            $('#scrollingmodal').modal('show');

            // Save changes button click handler
            $('.save-specs-button').off('click').on('click', function() {
                var newSpecs = modalSpecsBody.value;
                event.target.setAttribute('data-specs', newSpecs);
                $('#scrollingmodal').modal('hide');
            });
        }
    }
});
// Event listener for edit button to toggle edit mode  (TO CHECK IF IT CAN BE REMOVABLE SAFELY!!)
$(document).on('click', '.btn-edit-requests', function() {
    $('#requests').toggleClass('edit-mode-requests');
    if ($('#requests').hasClass('edit-mode-requests')) {
        $('.save-specs-button').show();
    } else {
        $('.save-specs-button').hide();
        $('#modalSpecsBody').attr('readonly', true);
    }
});


// Function to merge table cells in the first column only
function mergeTableCells(table) {
    var colIndex = 0; // Only apply to the first column
    var prevCell = null;
    var spanCount = 1;
    for (var rowIndex = 0; rowIndex < table.rows.length; rowIndex++) {
        var cell = table.rows[rowIndex].cells[colIndex];
        if (prevCell && cell.innerText === prevCell.innerText) {
            spanCount++;
            prevCell.rowSpan = spanCount;
            cell.style.display = 'none';
            prevCell.classList.add('centered-cell'); // Add the class to center the text
        } else {
            prevCell = cell;
            spanCount = 1;
        }
    }
}


       // Function to unmerge table cells
function unmergeTableCells(table) {
    for (var rowIndex = 0; rowIndex < table.rows.length; rowIndex++) {
        var row = table.rows[rowIndex];
        for (var colIndex = 0; colIndex < row.cells.length; colIndex++) {
            var cell = row.cells[colIndex];
            if (cell.rowSpan > 1) {
                // Reset rowSpan
                cell.rowSpan = 1;
                cell.classList.remove('centered-cell'); // Remove the centered class
            }
        }
    }
    
    // Make all hidden cells visible again
    for (var rowIndex = 0; rowIndex < table.rows.length; rowIndex++) {
        var row = table.rows[rowIndex];
        for (var colIndex = 0; colIndex < row.cells.length; colIndex++) {
            var cell = row.cells[colIndex];
            cell.style.display = ''; // Make the cell visible
        }
    }
}

function sortTableRows(table) {
    var $rows = $(table).find('tbody tr');

    // Sort rows based on the first column (supplier)
    $rows.sort(function(a, b) {
        var supplierA = $(a).find('td').first().text().toLowerCase();
        var supplierB = $(b).find('td').first().text().toLowerCase();
        return supplierA.localeCompare(supplierB);
    });

    // Re-insert sorted rows into the table body
    $.each($rows, function(index, row) {
        $(table).children('tbody').append(row);
    });
}

    <!-- Function to make offers tables editable -->

    $(document).ready(function() {
    // Make all fields in the specified table editable
    $(document).on('click', '.btn-edit-offers', function() {
        var targetTableId = $(this).data('target');
        var $table = $('#' + targetTableId);
        var $card = $table.closest('.card');
        unmergeTableCells($table[0]);
        // Make all cells editable
        $table.find('td').attr('contenteditable', 'true');
        // Ensure cells with the 'noteditable' class are not editable
        $table.find('td.noteditable').attr('contenteditable', 'false');
        // Convert validity cells to date input fields
        $table.find('td.validity-cell').each(function() {
            var text = $(this).text().trim();
            $(this).html('<input type="date" class="form-control" value="' + (text === 'DD/MM/YYYY' ? '' : text) + '">');
        });
        $table.addClass('edit-mode');  // Add edit mode class to table
        $card.find('.btn-save-offers[data-target="' + targetTableId + '"]').show();
        $card.find('.btn-add-offer[data-target="' + targetTableId + '"]').show();
        $(this).hide();
    });

    // Add a new editable row when "Add New Offer" is clicked
    $(document).on('click', '.btn-add-offer', function() {
        var targetTableId = $(this).data('target');
        var $table = $('#' + targetTableId);
        var newRow = `<tr>
                        <td class="noteditable" data-toggle="modal" data-target="#supplierDetailModal"><a href="javascript:void(0);" contenteditable="false"></a></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td class="validity-cell"><input type="date" class="form-control"></td>
                        <td contenteditable="true"></td>
                      </tr>`;
        $table.find('tbody').append(newRow);
    });

    // Handle the save action for the specified table
    $(document).on('click', '.btn-save-offers', function() {
        var targetTableId = $(this).data('target'); // Get the target table ID using the updated data-target format
        var requestIdParts = targetTableId.split('-'); // Split the targetTableId by '-'
        var requestId = requestIdParts[requestIdParts.length - 1]; // Get the last part, which is the requestId
        console.log(requestId)
        var $table = $('#' + targetTableId); // Find the table by ID
        var $card = $table.closest('.card'); // Find the closest card to this table
        var offersToUpdate = []; // Array to hold data for all offers in this table
        var allValid = true; // Flag to track date validity
        $table.find('tbody tr').each(function() {
            var $row = $(this);
            var offerId = $row.data('offer-id');
            var validity = $row.find('td:eq(7) input').val().trim();

            var offerData = {
                id: offerId,
                supplier: $row.find('td:eq(0)').clone().children('.supplier-email-status').remove().end().text(),
                supplier_price: $row.find('td:eq(1)').text(),
                payment_terms: $row.find('td:eq(2)').text(),
                incoterms: $row.find('td:eq(3)').text(),
                specs: $row.find('td:eq(4)').text(),
                size: $row.find('td:eq(5)').text(),
                packaging: $row.find('td:eq(6)').text(),
                validity: validity,
                notes: $row.find('td:eq(8)').text(),
            };
            offersToUpdate.push(offerData);
        });

        if (!allValid) return;

        // Send AJAX request to save all updated offers for this table
        $.ajax({
            url: '/update_offers/', // Update this URL to your actual endpoint
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify([{'request_id': requestId},{offers: offersToUpdate}]),
            success: function(response) {
                toastr.success('Data updated successfully!', 'Success');
                sortTableRows($table);
                mergeTableCells($table[0]);
                $table.find('td').attr('contenteditable', 'false');
                // Convert validity cells back to plain text
                $table.find('td.validity-cell').each(function() {
                    var text = $(this).find('input').val().trim();
                    $(this).text(text === '' ? 'DD/MM/YYYY' : text);
                });
                $table.removeClass('edit-mode');  // Remove edit mode class from table
                $card.find('.btn-edit-offers[data-target="' + targetTableId + '"]').show(); // Show the edit button again
                $card.find('.btn-save-offers[data-target="' + targetTableId + '"]').hide(); // Hide the save button
                $card.find('.btn-add-offer[data-target="' + targetTableId + '"]').hide(); // Hide the add button
            },
            error: function(error) {
                sortTableRows($table);
                mergeTableCells($table[0]);
                toastr.error('An error occurred. Changes not saved');
                console.log(error);
            }
        });
    });
    let currentTd; 
    

    $(document).on('click', '.noteditable', function() {
    var $table = $(this).closest('table');
    if ($table.hasClass('edit-mode')) {
        currentTd = $(this);  // Store the reference to the clicked <td>
        console.log("passei")
        // Inject the provided HTML content into the modal body
        var modalContent = `
            <div class="form-group">
                <label class="form-label">Supplier</label>
                <select id="supplier-select" class="form-control select2-show-search form-select select2-hidden-accessible" data-placeholder="Choose one" aria-hidden="true">
                </select>
            </div>
        `;
        $('#supplier-details-content').html(modalContent);
        $('#supplierDetailModal').modal('show');
    }
});

// Initialize select2 after the modal is shown
$('#supplierDetailModal').on('shown.bs.modal', function () {
    // Populate the select element with supplier options
    let $select = $('#supplier-select');
    $select.empty();  // Clear any existing options
    const suppliers = {{ suppliers|safe }};
    suppliers.forEach(function(supplier) {
        $select.append(new Option(supplier, supplier));
    });

    // Pre-select the current supplier
    if (currentTd) {
        var currentSupplier = currentTd.find('a').text();  // Fetch the current supplier from <td>
        $select.val(currentSupplier).trigger('change');  // Pre-select the current supplier
    }

    $('.select2-show-search').select2({
        dropdownParent: $('#supplierDetailModal'), // Ensure dropdown is appended to the modal
        width: '100%',
        tags: true,
        minimumInputLength: 1,
        placeholder: "Select suppliers",
        createTag: function(params) {
            var term = $.trim(params.term);
            if (term === '') {
                return null;
            }
            var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
            var exists = $('.select2-show-search').find('option').filter(function() {
                return $(this).text().toLowerCase() === normalizedTerm;
            }).length > 0;
            if (exists) {
                return null;
            }
            return {
                id: term,
                text: term,
                newTag: true
            };
        }
    }).on('select2:select', function(e) {
        if (e.params.data.newTag) {
            console.log("New option added:", e.params.data.text);
            // Additional logic for new tags can be implemented here
        }
    });
});

// Handle the confirm button click
$('#confirm-supplier-selection').on('click', function() {
    var selectedSupplier = $('#supplier-select').val();
    if (currentTd) {
        currentTd.find('a').text(selectedSupplier);  // Update the <a> tag with the new supplier name
        $('#supplierDetailModal').modal('hide');  // Hide the modal
    }
});

// Handle the delete row button click
$('#delete-row').on('click', function() {
    $('#deleteConfirmationModal').modal('show');
});

// Confirm deletion of row
$('#confirm-delete-row').on('click', function() {
    if (currentTd) {
        currentTd.closest('tr').remove();  // Delete the row
        $('#deleteConfirmationModal').modal('hide');  // Hide the confirmation modal
        $('#supplierDetailModal').modal('hide');  // Hide the supplier detail modal
    }
});

});

//To make requests table editable    

$(document).ready(function() {
    // Make request fields editable
    $(document).on('click', '.btn-edit-requests', function() {
        $table = $('#' + "requests");
        $table.addClass('edit-mode-requests');  // Add edit mode class to table
        $('#requests').find('td').attr('contenteditable', 'true');
        $('#requests').find('td.noteditable').attr('contenteditable', 'false');
        $('.btn-save-requests').show(); // Show the save button for requests
        $('.btn-add-requests').show();
        $(this).hide(); // Hide the edit button for requests
        unmergeTableCells($table[0]);
    });

  // Handle adding new requests
$(document).on('click', '.btn-add-requests', function() {
    var $table = $('#requests');
    var deliveryScheduleModalId = `deliveryScheduleModal-new`; // Use a temporary ID for new requests
    var newRow = `<tr>
                    <td class="product-noteditable"></td>
                    <td class="quantity-field noteditable" data-product-name="" data-modal-id="${deliveryScheduleModalId}" data-delivery-schedule='[]'></td>
                    <td contenteditable="true"></td>
                    <td><a href="" class="specs-link" data-specs="" data-bs-toggle="modal" data-bs-target="#scrollingmodal">View Specs</a></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                </tr>`;
    $table.find('tbody').append(newRow);
});

   // Handle the save action for requests
$(document).on('click', '.btn-save-requests', function() {
    var requestsToUpdate = [];
    $('#requests tbody tr').each(function() {
        var enquiryId = '{{ enquiry.id }}';
        var $row = $(this);
        // Assuming each row has a data-request-id attribute
        var requestId = $row.data('request-id');
        var deliverySchedule = $row.find('td:eq(1)').data('delivery-schedule');  // Retrieve the delivery schedule data

        var requestData = {
            id: requestId,
            product: $row.find('td:eq(0)').text().trim(),
            quantity: $row.find('td:eq(1)').text().trim(),
            quantity_unit: $row.find('td:eq(2)').text().trim(),
            specs: $row.find('td:eq(3)').find('a').data('specs'),
            size: $row.find('td:eq(4)').text().trim(),
            packaging: $row.find('td:eq(5)').text().trim(),
            payment_terms_requested: $row.find('td:eq(6)').text().trim(),
            target_price: $row.find('td:eq(7)').text().trim(),
            incoterms: $row.find('td:eq(8)').text().trim(),
            notes: $row.find('td:eq(9)').text().trim(),
            delivery_schedule: deliverySchedule  // Use the delivery schedule data
        };
        requestsToUpdate.push(requestData);
    });

    // Log the data to be sent for verification
    console.log(JSON.stringify({enquiry_id: enquiryId, requests: requestsToUpdate}));

    // Send AJAX request to save all updated requests
    $.ajax({
        url: '/update_requests/',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify([{enquiry_id: enquiryId},{requests: requestsToUpdate}]),
        success: function(response) {
            toastr.success('Data updated successfully!', 'Success');
            $('#requests').find('td').attr('contenteditable', 'false');
            $table.removeClass('edit-mode-requests');  // Remove edit mode class from table
            $('.btn-edit-requests').show(); // Show the edit button for requests again
            $('.btn-save-requests').hide(); // Hide the save button for requests
            $('.btn-add-requests').hide();
            mergeTableCells($table[0]);
            sortTableRows($table);
        },
        error: function(error) {
            toastr.error('Data was not updated!', 'Error');
            console.log(error);
        }
    });
});
    var currentProductTd;

    // Handle product column click
    $(document).on('click', '.product-noteditable', function() {
        var $table = $(this).closest('table');
        if ($table.hasClass('edit-mode-requests')) {
            currentProductTd = $(this);  // Store the reference to the clicked <td>
            var modalContent = `
                <div class="form-group">
                    <label class="form-label">Product</label>
                    <select id="product-select" class="form-control select2-show-search form-select select2-hidden-accessible" data-placeholder="Choose one" aria-hidden="true">
                    </select>
                </div>
            `;
            $('#product-details-content').html(modalContent);
            $('#productDetailModal').modal('show');
        }
    });

    // Initialize select2 after the modal is shown
    $('#productDetailModal').on('shown.bs.modal', function () {
        // Populate the select element with product options
        let $select = $('#product-select');
        $select.empty();  // Clear any existing options
        const products = {{ products|safe }};
        products.forEach(function(product) {
            $select.append(new Option(product, product));
        });

        // Pre-select the current product
        if (currentProductTd) {
            var currentProduct = currentProductTd.text().trim();  // Fetch the current product from <td>
            $select.val(currentProduct).trigger('change');  // Pre-select the current product
        }

        $('.select2-show-search').select2({
            dropdownParent: $('#productDetailModal'), // Ensure dropdown is appended to the modal
            width: '100%',
            tags: true,
            minimumInputLength: 1,
            placeholder: "Select product",
            createTag: function(params) {
                var term = $.trim(params.term);
                if (term === '') {
                    return null;
                }
                var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                var exists = $('.select2-show-search').find('option').filter(function() {
                    return $(this).text().toLowerCase() === normalizedTerm;
                }).length > 0;
                if (exists) {
                    return null;
                }
                return {
                    id: term,
                    text: term,
                    newTag: true
                };
            }
        }).on('select2:select', function(e) {
            if (e.params.data.newTag) {
                console.log("New option added:", e.params.data.text);
                // Additional logic fornew tags can be implemented here
}
});
});

// Handle the confirm button click for product selection
$('#confirm-product-selection').on('click', function() {
    var selectedProduct = $('#product-select').val();
    if (currentProductTd) {
        currentProductTd.text(selectedProduct);  // Update the <td> with the new product name
        $('#productDetailModal').modal('hide');  // Hide the modal
    }
});

// Handle the delete row button click for product modal
$('#delete-product-row').on('click', function() {
    $('#deleteConfirmationModal').modal('show');
});

// Confirm deletion of row
$('#confirm-delete-row').on('click', function() {
    if (currentProductTd) {
        currentProductTd.closest('tr').remove();  // Delete the row
        $('#deleteConfirmationModal').modal('hide');  // Hide the confirmation modal
        $('.modal').modal('hide');  // Hide any open modals
    }
});

});



    </script>


 <!-- Function to make client offers tables editable-->
<script>

$(document).ready(function() {
    $(document).on('click', '.btn-edit-clientoffers', function() {
        var targetTableId = $(this).data('target');
        var $table = $('#' + targetTableId);
        var $card = $table.closest('.card');

        $table.find('td').attr('contenteditable', 'true');
        $table.find('td.editable-supplier').attr('contenteditable', 'false');

        // Convert validity cells to date input fields
        $table.find('td.validity-cell').each(function() {
            var text = $(this).text().trim();
            $(this).html('<input type="date" class="form-control" value="' + (text === 'DD/MM/YYYY' ? '' : text) + '">');
        });

        $table.addClass('edit-mode'); 

        $card.find('.btn-save-clientoffers[data-target="' + targetTableId + '"]').show();
        $card.find('.btn-add-clientoffers[data-target="' + targetTableId + '"]').show();
        $(this).hide();
        unmergeTableCells($table[0]);
    });

    // Add a new editable row for client offers when "Add New Offer" is clicked
    $(document).on('click', '.btn-add-clientoffers', function() {
        var targetTableId = $(this).data('target');
        var $table = $('#' + targetTableId);
        var newRow = `<tr>
                        <td class="editable-supplier" data-toggle="modal" data-target="#supplierDetailModalClient"><a href="javascript:void(0);" contenteditable="false"></a></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td class="validity-cell"><input type="date" class="form-control"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>`;
        $table.find('tbody').append(newRow);
    });

    // Handle the save action for client offers in the specified table
    $(document).on('click', '.btn-save-clientoffers', function() {
        var targetTableId = $(this).data('target');
        var requestIdParts = targetTableId.split('-'); // Split the targetTableId by '-'
        var requestId = requestIdParts[requestIdParts.length - 1]; // Get the last part, which is the requestId
       
        var $table = $('#' + targetTableId);
        var $card = $table.closest('.card');
        var offersToUpdate = [];

        $table.find('tbody tr').each(function() {
            var $row = $(this);
            var offerClientId = $row.data('offer-client-id');
            var validity = $row.find('td:eq(5) input').val().trim();
            var offerData = {
                id: offerClientId, // This may be 'new' for new rows
                supplier: $row.find('td:eq(0)').text(),
                price_offered: $row.find('td:eq(1)').text(),
                margin: $row.find('td:eq(2)').text(),
                payment_term_offered: $row.find('td:eq(3)').text(),
                incoterms: $row.find('td:eq(4)').text(),
                validity_offered: validity,
                customer_feedback: $row.find('td:eq(6)').text(),
                notes: $row.find('td:eq(7)').text(),
            };
            offersToUpdate.push(offerData);
        });

        // AJAX request to save/update client offers
        $.ajax({
            url: '/update_client_offers/', // Update this URL to your actual endpoint for client offers
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify([{'request_id': requestId},{offers: offersToUpdate}]),
            success: function(response) {
                toastr.success('Data updated successfully!', 'Success');
                $table.find('td').attr('contenteditable', 'false');

                // Convert validity cells back to plain text
                $table.find('td.validity-cell').each(function() {
                    var text = $(this).find('input').val().trim();
                    $(this).text(text === '' ? 'DD/MM/YYYY' : text);
                });

                $card.find('.btn-edit-clientoffers[data-target="' + targetTableId + '"]').show(); // Show the edit button again
                $card.find('.btn-save-clientoffers[data-target="' + targetTableId + '"]').hide(); // Hide the save button
                $card.find('.btn-add-clientoffers[data-target="' + targetTableId + '"]').hide(); // Hide the add new offer button
                sortTableRows($table);
                mergeTableCells($table[0]);
            },
            error: function(error) {
                console.log(error);
                toastr.error('Data was not saved', 'Error');
                sortTableRows($table);
                mergeTableCells($table[0]);
            }
        });
    });

    let currentTd;  // Variable to store the reference to the clicked <td>
    $(document).on('click', '.editable-supplier', function() {
        var $table = $(this).closest('table');
        if ($table.hasClass('edit-mode')) {
            currentTd = $(this);  // Store the reference to the clicked <td>
            // Inject the provided HTML content into the modal body
            var modalContent = `
                <div class="form-group">
                    <label class="form-label">Supplier</label>
                    <select id="supplier-select" class="form-control select2 form-select select2-hidden-accessible" data-placeholder="Choose one" aria-hidden="true">
                    </select>
                </div>
            `;
            $('#supplier-client-details-content').html(modalContent);
            $('#supplierDetailModalClient').modal('show');
        }
    });

    // Initialize select2 after the modal is shown
    $('#supplierDetailModalClient').on('shown.bs.modal', function () {
        // Populate the select element with supplier options
        let $select = $('#supplier-select');
        $select.empty();  // Clear any existing options
        var requestId = currentTd.closest('table').attr('id').split('-').pop();
        var suppliers = supplierNamesByRequestId[requestId] || [];
        suppliers.forEach(function(supplier) {
            $select.append(new Option(supplier, supplier));
        });

        // Pre-select the current supplier
        if (currentTd) {
            var currentSupplier = currentTd.find('a').text();  // Fetch the current supplier from <td>
            $select.val(currentSupplier).trigger('change');  // Pre-select the current supplier
        }

        $('.select2-hidden-accessible').select2({
            dropdownParent: $('#supplierDetailModalClient'), // Ensure dropdown is appended to the modal
            width: '100%',
            tags: false,
            minimumResultsForSearch: Infinity,
            placeholder: "Select suppliers"
        })
    });

    // Handle the confirm button click in the modal
    $('#confirm-client-supplier-selection').on('click', function() {
        var selectedSupplier = $('#supplier-select').val();
        if (currentTd) {
            currentTd.find('a').text(selectedSupplier);  // Update the <a> tag with the new supplier name
            $('#supplierDetailModalClient').modal('hide');  // Hide the modal
        }
    });

        // Handle the delete row button click for supplier modal
    $('#delete-supplier-row').on('click', function() {
        $('#deleteConfirmationModal').modal('show');
    });

        // Confirm deletion of row
    $('#confirm-delete-row').on('click', function() {
        if (currentTd) {
            currentTd.closest('tr').remove();  // Delete the row
            $('#deleteConfirmationModal').modal('hide');  // Hide the confirmation modal
            $('.modal').modal('hide');  // Hide any open modals
        }
    });

});




//monitors changes to the enquiry details

$(document).ready(function() {
    $('.col-md-2 input, .col-md-2 select').change(function() {
        var $input = $(this);
        var value = $input.val();
        var name = $input.attr('name') || $input.attr('id');
        var data = {'enquiry_id' : '{{ enquiry.id }}'.trim() }; // Remove any trailing spaces

        // Check if it's a date input and reformat the value to DD/MM/YYYY
        if ($input.attr('type') === 'date' && value) {
            var date = new Date(value);
            var day = ("0" + date.getDate()).slice(-2);
            var month = ("0" + (date.getMonth() + 1)).slice(-2);
            var formattedDate = `${day}/${month}/${date.getFullYear()}`;
            value = formattedDate;
        }

        data[name] = value;

        // Send the AJAX request
        $.ajax({
            url: '/update_enquiry_details/', // URL of the Django view
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json',
            dataType: 'json',
            success: function(response) {
                console.log(data, response);
                toastr.success('Data updated successfully!', 'Success');
            },
            error: function(error) {
                console.error('Update failed:', error);
                toastr.error('Failed to update the information. Please try again.');
            }
        });
    });
});




//handles logic to send emails

    $(document).ready(function() {
        // Handle showing checkboxes and buttons
        $('body').on('click', '.btn-add-checkboxes', function() {
            var tableId = $(this).data('table-id');
            var $table = $('#' + tableId);
            if (!$table.hasClass('checkboxes-added')) {
                $table.addClass('checkboxes-added');
                $table.find('tbody tr').each(function() {
                    $(this).prepend($('<td>').append($('<input type="checkbox" class="select-supplier-checkbox">')));
                });
                $table.find('thead tr').prepend('<th>Select</th>');
            }
            $(this).siblings('.btn-cancel-emails, .btn-confirm-emails').show();
            $(this).hide();
            $(this).siblings('.btn-edit-offers, .btn-save-offers').prop('disabled', true);  // Disable edit/save buttons
        });
    
        // Handle the cancellation of selection
        $('body').on('click', '.btn-cancel-emails', function() {
            var tableId = $(this).data('table-id');
            var $table = $('#' + tableId);
            $table.removeClass('checkboxes-added');
            $table.find('thead th:first, tbody td:first-child').remove();
            $(this).siblings('.btn-add-checkboxes').show();
            $(this).siblings('.btn-confirm-emails').hide();
            $(this).hide();
            $(this).siblings('.btn-edit-offers, .btn-save-offers').prop('disabled', false);  // Enable edit/save buttons
        });
    
        // Directly handle the confirm button to redirect with selected supplier IDs
        $('body').on('click', '.btn-confirm-emails', function() {
            var tableId = $(this).data('table-id');
            var requestId = tableId.match(/\d+/)[0]; 
  
            var selectedSuppliers = [];
            $('#' + tableId + ' tbody .select-supplier-checkbox:checked').each(function() {
                selectedSuppliers.push($(this).closest('tr').data('supplier-id'));  // Ensure data-offer-id is correctly set in each row
            });
    
            if (selectedSuppliers.length > 0) {
                var params = {
                supplier_ids: selectedSuppliers,
                request_id: requestId  // Adding the request.id as request_id in the URL parameters
            };
                console.log('/display-draft-email/?' + $.param(params));
                window.location.href = '/display-draft-email/?' + $.param(params);
            } else {
                toastr.error('No suppliers selected.');
            }
        });
    
        // Handle edit all button
        $('body').on('click', '.btn-edit-offers', function() {
            var targetId = $(this).data('target');
            var $table = $('#' + targetId);
            $table.find('tbody tr td').attr('contenteditable', true);
            $(this).hide();
            $(this).siblings('.btn-save-offers').show();
            $(this).siblings('.btn-add-checkboxes').prop('disabled', true);  // Disable send emails button
        });
    
        // Handle save all button
        $('body').on('click', '.btn-save-offers', function() {
            var targetId = $(this).data('target');
            var $table = $('#' + targetId);
            $table.find('tbody tr td').attr('contenteditable', false);
            $(this).hide();
            $(this).siblings('.btn-edit-offers').show();
            $(this).siblings('.btn-add-checkboxes').prop('disabled', false);  // Enable send emails button
        });
    });
    </script>
    
    <!-- Script to adjust selection boxes in the form-->>
    
    <style>
        .supplier-email-status {
    display: inline-block;
    margin-left: 5px; /* Adjust this value to control the spacing between the supplier name and the emojis */
}
.centered-cell {
    
    vertical-align: middle;
    
}
    </style>
</body>

</html>