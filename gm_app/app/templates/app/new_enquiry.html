<!doctype html>
<html lang="en" dir="ltr" style="--primary-rgb: 28,103,147;">

<head>
    {% load static %}
    <!-- META DATA -->
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sash – Bootstrap 5  Admin & Dashboard Template">
    <meta name="author" content="Spruko Technologies Private Limited">
    <meta name="keywords" content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit.">

    <!-- FAVICON -->
    <link rel="shortcut icon" type="image/x-icon" href=" {% static '/assets/images/brand/favicon.ico' %} ">

    <!-- TITLE -->
    <title>Global Monarch</title>

    <!-- BOOTSTRAP CSS -->
    <link id="style" href=" {% static '/assets/plugins/bootstrap/css/bootstrap.min.css' %} " rel="stylesheet">

    <!-- STYLE CSS -->
     <link href=" {% static '/assets/css/style.css' %} " rel="stylesheet">

	<!-- Plugins CSS -->
    <link href=" {% static '/assets/css/plugins.css' %} " rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!--- FONT-ICONS CSS -->
    <link href=" {% static '/assets/css/icons.css' %} " rel="stylesheet">

    <!-- INTERNAL Switcher css -->
    <link href=" {% static '/assets/switcher/css/switcher.css' %} " rel="stylesheet">
    <link href=" {% static '/assets/switcher/demo.css' %} " rel="stylesheet">
</head>

<body class="app sidebar-mini ltr light-mode">

    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src=" {% static '/assets/images/loader.gif' %} " class="loader-img" alt="Loader">
    </div>
    <!-- /GLOBAL-LOADER -->

    <!-- PAGE -->
    <div class="page">
        <div class="page-main">

            <!-- app-Header -->
            <div class="app-header header sticky">
                <div class="container-fluid main-container">
                    <div class="d-flex">
                        <a aria-label="Hide Sidebar" class="app-sidebar__toggle" data-bs-toggle="sidebar" href=" {% static 'javascript:void(0)' %} "></a>
                        <!-- sidebar-toggle-->
                        <a class="logo-horizontal " href=" {% static 'index.html' %} ">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>

                       
                        <div class="d-flex order-lg-2 ms-auto header-right-icons">
                            <!-- SEARCH -->
                            <button class="navbar-toggler navresponsive-toggler d-lg-none ms-auto" type="button"
                                data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent-4"
                                aria-controls="navbarSupportedContent-4" aria-expanded="false"
                                aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon fe fe-more-vertical"></span>
                            </button>
                            <div class="navbar navbar-collapse responsive-navbar p-0">
                                <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
                                    <div class="d-flex order-lg-2">
                                            <a href="{% static 'javascript:void(0)' %}" class="nav-link icon"
                                                data-bs-toggle="dropdown" data-target="">
                                                <i class="fa fa-sort-down"></i>
                                            </a>
                                            <div class="dropdown  d-flex notifications">
                                                <a class="nav-link icon" data-bs-toggle="dropdown" aria-expanded="false"><i class="fe fe-bell"></i><span class=" pulse"></span>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                    <div class="drop-heading border-bottom">
                                                        <div class="d-flex">
                                                            <h6 class="mt-1 mb-0 fs-16 fw-semibold text-dark">Notifications
                                                            </h6>
                                                        </div>
                                                    </div>
                                                    <div class="notifications-menu ps">
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-primary brround box-shadow-primary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">New change made to enquiry of FM96 to Kumas
                                                                </h5>
                                                                <span class="notification-subtext">1 hour ago</span>
                                                            </div>
                                                        </a>
                                                        <a class="dropdown-item d-flex" href="notify-list.html">
                                                            <div class="me-3 notifyimg  bg-secondary brround box-shadow-secondary">
                                                                <i class="fe fe-mail"></i>
                                                            </div>
                                                            <div class="mt-1 wd-80p">
                                                                <h5 class="notification-label mb-1">Enquiry deadline coming up</h5>
                                                                <span class="notification-subtext">2 hours ago</span>
                                                            </div>
                                                        </a>
                                                       
                                                    <div class="ps__rail-x" style="left: 0px; bottom: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div></div></div>
                                                    <div class="dropdown-divider m-0"></div>
                                                    <a href="notify-list.html" class="dropdown-item text-center p-3 text-muted">View all
                                                        Notification</a>
                                                </div>
                                            </div>
                                        <!-- SIDE-MENU -->
                                        <div class="dropdown d-flex profile-1">
                                            <a href=" {% static 'javascript:void(0)' %} " data-bs-toggle="dropdown" class="nav-link leading-none d-flex">
                                                <img src=" {% static '/assets/images/users/21.jpg' %} " alt="profile-user"
                                                    class="avatar  profile-user brround cover-image">
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                                <div class="drop-heading">
                                                    <div class="text-center">
                                                        <h5 class="text-dark mb-0 fs-14 fw-semibold">{{request.user.username}}</h5>
                                                    </div>
                                                </div>
                                                <div class="dropdown-divider m-0"></div>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-user"></i> Profile
                                                </a>
                                                <a class="dropdown-item" href="">
                                                    <i class="dropdown-icon fe fe-alert-circle"></i> Sign out
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /app-Header -->

            <!--APP-SIDEBAR-->
            <div class="sticky">
                <div class="app-sidebar__overlay" data-bs-toggle="sidebar"></div>
                <div class="app-sidebar">
                    <div class="side-header">
                        <a class="header-brand1" href="">
                            <img src=" {% static '/assets/images/brand/logo-white.png' %} " class="header-brand-img desktop-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-white.png' %} " class="header-brand-img toggle-logo"
                                alt="logo">
                            <img src=" {% static '/assets/images/brand/icon-dark.png' %} " class="header-brand-img light-logo" alt="logo">
                            <img src=" {% static '/assets/images/brand/logo-dark.png' %} " class="header-brand-img light-logo1"
                                alt="logo">
                        </a>
                        <!-- LOGO -->
                    </div>
                    <div class="main-sidemenu">
                        <div class="slide-left disabled" id="slide-left"><svg xmlns="http://www.w3.org/2000/svg"
                                fill="#7b8191" width="24" height="24" viewBox="0 0 24 24">
                                <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" />
                            </svg></div>
                            <ul class="side-menu">
                           
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                            class="side-menu__icon fe fe-home"></i><span
                                            class="side-menu__label">Home</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/enquiry_list"><i
                                            class="side-menu__icon fe fe-send"></i><span
                                            class="side-menu__label">Enquiries</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/"><i
                                            class="side-menu__icon fe fe-pie-chart"></i><span
                                            class="side-menu__label">Create new Enquiry</span></a>
                                </li>
                                <li class="slide">
                                    <a class="side-menu__item has-link" data-bs-toggle="slide" href="/supplier_list"><i
                                            class="side-menu__icon fe fe-activity"></i><span
                                            class="side-menu__label">Supplier Management</span></a>
                                </li>
    
                            </ul>
                        <div class="slide-right" id="slide-right"><svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191"
                                width="24" height="24" viewBox="0 0 24 24">
                                <path d="M10.707 17.707 16.414 12l-5.707-5.707-1.414 1.414L13.586 12l-4.293 4.293z" />
                            </svg></div>
                    </div>
                </div>
            </div>
            <!--/APP-SIDEBAR-->

            <!--app-content open-->
            <div class="main-content app-content mt-0">
                <div class="side-app">

                    <!-- CONTAINER -->
                    <div class="main-container container-fluid">

                        <!-- PAGE-HEADER -->
                        <div class="page-header">
                            <h1 class="page-title">Enquiry Management</h1>
                            <div>
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href=" {% static 'javascript:void(0)' %} ">Pages</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Empty</li>
                                </ol>
                            </div>
                        </div>
                        <!-- PAGE-HEADER END -->

                        <!-- ROW-1 OPEN -->
                        <!-- Row -->
                        <div class="row ">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            Register new Enquiry
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-5">
                                        <div id="wizard3" role="application" class="wizard clearfix vertical"><div class="steps clearfix"><ul role="tablist"><li role="tab" class="first current" aria-disabled="false" aria-selected="true"><a id="wizard3-t-0" href="#wizard3-h-0" aria-controls="wizard3-p-0"><span class="current-info audible">current step: </span><span class="number">1</span> <span class="title">Enquiry Information</span></a></li><li role="tab" class="done" aria-disabled="false" aria-selected="false"><a id="wizard3-t-1" href="#wizard3-h-1" aria-controls="wizard3-p-1"><span class="number">2</span> <span class="title">Details of the request</span></a></li><li role="tab" class="last done" aria-disabled="false" aria-selected="false"><a id="wizard3-t-2" href="#wizard3-h-2" aria-controls="wizard3-p-2"><span class="number">3</span> <span class="title">Supplier Selection</span></a></li></ul></div><div class="content clearfix">
                                            <h3 id="wizard3-h-0" tabindex="-1" class="title current">Enquiry Information</h3>
                                            <section id="wizard3-p-0" role="tabpanel" aria-labelledby="wizard3-h-0" class="body current" aria-hidden="false" style="">
                                                <div class="control-group form-group">
                                                    <label class="form-label">Manager</label>
                                                    <input type="text" class="form-control required" placeholder="{{ manager.name }}" id = "managerName" readonly>
                                                </div>

                                                <div class="form-group">
                                                    <label class="form-label"> Customer</label>
                                                    <select class="form-control select2-show-search form-select select2-hidden-accessible" data-placeholder="Choose one" tabindex="-1" aria-hidden="true">
                                                        <option value="None">Select one</option>
                                                            {% for client in clients %}
        <option value="{{ client }}">{{ client }}</option>
        {% endfor %}
                                                        </select>
                                                </div>

                                                <div class="form-group">
                                                    <label class="form-label">Customer Contact Person</label>
                                                    <input type="text" class="form-control required" placeholder="Name" id='customerContact'>
                                                </div>

                                                
                                                 <!-- Inquiry Received Date Button -->
                                                <div class="form-group">
                                                    <label class="form-label">Inquiry Received Date</label>
                                                    <div class="input-group">
                                                        <div class="input-group-text">
                                                            <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                                        </div>
                                                        <input type="date" class="form-control " placeholder="DD/MM/YYYY" type="text" id="inquiryReceivedDate">
                                                    </div>
                                                </div>

                                                <!-- Inquiry Deadline Date Button -->
                                                <div class="form-group">
                                                    <label class="form-label">Inquiry Deadline Date</label>
                                                    <div class="input-group">
                                                        <div class="input-group-text">
                                                            <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                                        </div>
                                                        <input type="date" class="form-control fc-datepicker" placeholder="DD/MM/YYYY" type="text" id="inquiryDeadlineDate">
                                                    </div>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label class="form-label">Incoterm Wanted</label>
                                                    <input type="text" class="form-control required" placeholder="CIF/CFR/FOB" id = "incotermWanted">
                                                </div>

                                                <!-- New file input field -->
                                                <div class="form-group">
                                                    <label class="form-label">Tender/Additonal Docs</label>
                                                    <input class="form-control file" type="file" id="formFileMultiple" multiple>
                                                </div>

                                            </section>
                                            <h3 id="wizard3-h-1" tabindex="-1" class="title">Details of the request</h3>
                                            <section id="wizard3-p-1" role="tabpanel" aria-labelledby="wizard3-h-1" class="body" aria-hidden="true" style="display: none;">
                                                <div class="form-group" id = "product_selector">
                                                    <label class="form-label">Select Products Requested</label>
                                                    <select class="form-control select2 select2-hidden-accessible" data-placeholder="Start typing" multiple="" tabindex="-1" aria-hidden="true">
                                                        {% for product in products %}
                                                        <option value="{{ product }}">{{ product }}</option>
                                                        {% endfor %}
                                                        </select>
                                                </div> 
                                                <div id="size-selectors-container"></div>
                                                
                                            </section>
                                            <h3 id="wizard3-h-2" tabindex="-1" class="title">Select Suppliers to Contact</h3>
                                            <section id="wizard3-p-2" role="tabpanel" aria-labelledby="wizard3-h-2" class="body" aria-hidden="true" style="display: none;">
                                            
                                            </section>
                                        </div><div class="actions clearfix"><ul role="menu" aria-label="Pagination"><li class="disabled" aria-disabled="true"><a href="#previous" role="menuitem">Previous</a></li><li aria-hidden="false" aria-disabled="false" class="" style=""><a href="#next" role="menuitem">Next</a></li><li aria-hidden="true" style="display: none;"><a id= "submit-button-id" href="#finish" role="menuitem">Finish</a></li></ul></div></div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                        <!-- /Row -->
                        
                    </div>
                    <!-- CONTAINER CLOSED -->
                </div>
            </div>
            <!--app-content closed-->
        </div>

        



        <!-- Country-selector modal-->

        <!-- FOOTER -->
        <footer class="footer">
            <div class="container">
                <div class="row align-items-center flex-row-reverse">
                    <div class="col-md-12 col-sm-12 text-center">
                        Copyright © <span id="year"></span> Global Monarch F.Z.C. Designed with <span class="fa fa-heart text-danger"></span> by <a href="javascript:void(0)"> GM-EU</a> All rights reserved.
                    </div>
                </div>
            </div>
        </footer>
        <!-- FOOTER CLOSED -->
    </div>
<!-- Modal template -->
<div class="modal fade" id="modalTemplate" tabindex="-1" role="dialog" aria-labelledby="modalTemplateLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTemplateLabel">Delivery Schedule for [ProductName]</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="multipleDeliveriesTableContainer" class="table-responsive">
                    <table class="table border text-nowrap text-md-nowrap table-sm mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Quantity</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="multipleDeliveriesTableBody-template">
                            <tr>
                                <td>1</td>
                                <td><input type="date" class="form-control"></td>
                                <td><input type="number" class="form-control delivery-quantity" placeholder="Enter quantity"></td>
                                <td><button type="button" class="btn btn-danger btn-sm remove-row">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-primary btn-sm mt-2 add-row-button" data-modal-id="template">Add Row</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary save-changes-button" data-modal-id="template">Save changes</button>
            </div>
        </div>
    </div>
</div>

    <!-- BACK-TO-TOP -->
    <a href=" {% static '#top' %} " id="back-to-top"><i class="fa fa-angle-up"></i></a>


    <!-- JQUERY JS -->
    <script src=" {% static '/assets/js/jquery.min.js' %} "></script>

    <!-- Toastr CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- BOOTSTRAP JS -->
    <script src=" {% static '/assets/plugins/bootstrap/js/popper.min.js' %} "></script>
    <script src=" {% static '/assets/plugins/bootstrap/js/bootstrap.min.js' %} "></script>

    <!-- INPUT MASK JS-->
    <script src=" {% static '/assets/plugins/input-mask/jquery.mask.min.js' %} "></script>

	<!-- TypeHead js -->
	<script src=" {% static '/assets/plugins/bootstrap5-typehead/autocomplete.js' %} "></script>
    <script src=" {% static '/assets/js/typehead.js' %} "></script>

    <!-- FILE UPLOADES JS -->
    <script src=" {% static '/assets/plugins/fileuploads/js/fileupload.js' %} "></script>
    <script src=" {% static '/assets/plugins/fileuploads/js/file-upload.js' %} "></script>

    <!-- INTERNAL File-Uploads Js-->
    <script src=" {% static '/assets/plugins/fancyuploder/jquery.ui.widget.js' %} "></script>
    <script src=" {% static '/assets/plugins/fancyuploder/jquery.fileupload.js' %} "></script>
    <script src=" {% static '/assets/plugins/fancyuploder/jquery.iframe-transport.js' %} "></script>
    <script src=" {% static '/assets/plugins/fancyuploder/jquery.fancy-fileupload.js' %} "></script>
    <script src=" {% static '/assets/plugins/fancyuploder/fancy-uploader.js' %} "></script>

    <!-- SELECT2 JS -->
    <script src=" {% static '/assets/plugins/select2/select2.full.min.js' %} "></script>
    <script src=" {% static '/assets/js/select2.js' %} "></script>

    <!-- INTERNAL Bootstrap-Datepicker js-->
    <script src=" {% static '/assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %} "></script>

    <!-- BOOTSTRAP-DATERANGEPICKER JS -->
    <script src=" {% static '/assets/plugins/bootstrap-daterangepicker/moment.min.js' %} "></script>

    <!-- INTERNAL Bootstrap-Datepicker js-->
  <!--   <script src=" {% static '/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js' %} "></script> -->

    <!-- INTERNAL Sumoselect js-->
    <script src=" {% static '/assets/plugins/sumoselect/jquery.sumoselect.js' %} "></script>

    <!-- TIMEPICKER JS -->
    <script src=" {% static '/assets/plugins/time-picker/jquery.timepicker.js' %} "></script>
    <script src=" {% static '/assets/plugins/time-picker/toggles.min.js' %} "></script>

    <!-- INTERNAL intlTelInput js-->
    <script src=" {% static '/assets/plugins/intl-tel-input-master/intlTelInput.js' %} "></script>
    <script src=" {% static '/assets/plugins/intl-tel-input-master/country-select.js' %} "></script>
    <script src=" {% static '/assets/plugins/intl-tel-input-master/utils.js' %} "></script>

    <!-- INTERNAL jquery transfer js-->
    <script src=" {% static '/assets/plugins/jQuerytransfer/jquery.transfer.js' %} "></script>

    <!-- INTERNAL multi js-->
    <script src=" {% static '/assets/plugins/multi/multi.min.js' %} "></script>

    <!-- DATEPICKER JS -->
    <!-- <script src=" {% static '/assets/plugins/date-picker/date-picker.js' %} "></script> -->
    <script src=" {% static '/assets/plugins/date-picker/jquery-ui.js' %} "></script>
    <script src=" {% static '/assets/plugins/input-mask/jquery.maskedinput.js' %} "></script>

    <!-- COLOR PICKER JS -->
    <script src=" {% static '/assets/plugins/pickr-master/pickr.es5.min.js' %} "></script>
    <script src=" {% static '/assets/js/picker.js' %} "></script>

    <!-- MULTI SELECT JS-->
    <script src=" {% static '/assets/plugins/multipleselect/multiple-select.js' %} "></script>
    <script src=" {% static '/assets/plugins/multipleselect/multi-select.js' %} "></script>

    <!-- Perfect SCROLLBAR JS-->
    <script src=" {% static '/assets/plugins/p-scroll/perfect-scrollbar.js' %} "></script>
    <script src=" {% static '/assets/plugins/p-scroll/pscroll.js' %} "></script>
    <script src=" {% static '/assets/plugins/p-scroll/pscroll-1.js' %} "></script>

    <!-- SIDE-MENU JS -->
    <script src=" {% static '/assets/plugins/sidemenu/sidemenu.js' %} "></script>

    <!-- SIDEBAR JS -->
    <script src=" {% static '/assets/plugins/sidebar/sidebar.js' %} "></script>

    <!-- FORMELEMENTS JS -->
    <script src=" {% static '/assets/js/formelementadvnced.js' %} "></script>
    <script src=" {% static '/assets/js/form-elements.js' %} "></script>

    <!-- Color Theme js -->
    <script src=" {% static '/assets/js/themeColors.js' %} "></script>

    <!-- Sticky js -->
    <script src=" {% static '/assets/js/sticky.js' %} "></script>

    <!-- CUSTOM JS -->
    <script src=" {% static '/assets/js/custom.js' %} "></script>

    <!-- Custom-switcher -->
    <script src=" {% static '/assets/js/custom-swicher.js' %} "></script>

    <!-- Switcher js -->
    <script src=" {% static '/assets/switcher/js/switcher.js' %} "></script>


   <!-- Script to Enable Wizard FUnctionality (lazy fix but it works) -->>
    
   <script>
    $(document).ready(function() {
        // Function to show the step based on index
        function showStep(index) {
            // Validate product selection before allowing transition to step 3
            if (index === 2 && !validateProductSelection()) {
                return; // Do not proceed to step 3 if validation fails
            }

            // Hide all sections and remove 'current' class from all h3 titles and 'current' from steps
            $('.wizard .content section').hide().attr('aria-hidden', 'true');
            $('.wizard .content .title').removeClass('current');
            $('.wizard .steps ul li').removeClass('current').attr('aria-selected', 'false');

            // Show the current section, add 'current' class to its title and step
            $('.wizard .content section').eq(index).show().attr('aria-hidden', 'false');
            $('#wizard3-h-' + index).addClass('current');
            $('.wizard .steps ul li').eq(index).addClass('current').attr('aria-selected', 'true');

            // Update steps status
            $('.wizard .steps ul li').removeClass('done');
            $('.wizard .steps ul li:lt(' + index + ')').addClass('done');

            // Update button visibility
            updateButtons(index);
        }

        // Function to update button visibility based on the current step
        function updateButtons(currentIndex) {
            $('.actions ul li a').removeClass('disabled').parent().show();
            $('.actions ul li a[href="#finish"]').parent().hide(); // Hide finish button initially

            if (currentIndex === 0) {
                $('.actions ul li a[href="#previous"]').addClass('disabled').parent().show();
            } else {
                $('.actions ul li a[href="#previous"]').removeClass('disabled').parent().show();
            }

            if (currentIndex === $('.wizard .content section').length - 1) {
                $('.actions ul li a[href="#next"]').parent().hide();
                $('.actions ul li a[href="#finish"]').parent().show(); // Show 'Finish' button on the last step
            } else {
                $('.actions ul li a[href="#next"]').parent().show();
                $('.actions ul li a[href="#finish"]').parent().hide(); // Hide 'Finish' button on other steps
            }

            // Disable the "Next" button if no products are selected when trying to move to step 3
            if (currentIndex === 1 && !validateProductSelection()) {
                $('.actions ul li a[href="#next"]').addClass('disabled');
            }
        }

        // Function to validate if any products are selected
        function validateProductSelection() {
            return $('#product_selector select').val().length > 0;
        }

        // Initialize the wizard by showing the first step
        showStep(0);

        // Next and Previous button click handlers
        $('.actions ul li a[href="#next"]').on('click', function(e) {
            e.preventDefault();
            var currentStep = $('.wizard .steps ul li.current').index();
            if (currentStep < $('.wizard .content section').length - 1 && !$(this).hasClass('disabled')) {
                showStep(currentStep + 1);
            }
        });

        $('.actions ul li a[href="#previous"]').on('click', function(e) {
            e.preventDefault();
            var currentStep = $('.wizard .steps ul li.current').index();
            if (currentStep > 0) {
                showStep(currentStep - 1);
            }
        });

        // Step title click handler to navigate directly to steps
        $('.wizard .steps ul li a').on('click', function(e) {
            e.preventDefault();
            var selectedStepIndex = $(this).parent().index();
            showStep(selectedStepIndex);
        });

        // Event listener for product selection change
        $('#product_selector select').on('change', function() {
            updateButtons($('.wizard .steps ul li.current').index());
        });

        // Initialize Select2 with specified settings
        function initializeSelect2WithTags($elements) {
            $elements.each(function() { // Iterate over each element individually
                var $element = $(this); // Current Select2 element being initialized
                $element.select2({
                    width: '100%',
                    tags: true, // Allows new options to be added
                    minimumInputLength: 1, // Only start searching when at least one character is typed
                    placeholder: "Select suppliers", // Placeholder text
                    createTag: function(params) {
                        var term = $.trim(params.term);
                        if (term === '') {
                            return null;
                        }
                        var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                        // Check for existing options within the current Select2 element
                        var exists = $element.find('option').filter(function() {
                            return $(this).text().toLowerCase() === normalizedTerm;
                        }).length > 0;
                        if (exists) {
                            return null;
                        }
                        return {
                            id: term,
                            text: term,
                            newTag: true
                        };
                    }
                }).on('select2:select', function(e) {
                    if (e.params.data.newTag) {
                        console.log("New option added:", e.params.data.text);
                        // Additional logic for new tags can be implemented here
                    }
                });
            });
        }

        // Initialize Select2 for elements already present
        initializeSelect2WithTags($('.select2-show-search'));

        // Example function to dynamically add new Select2 elements and initialize them
        function addAndInitializeNewSelect2Element() {
            var $newSelect = $('<select class="form-control select2-show-search" multiple=""></select>');
            // Append your new select element to the DOM as needed
            // For demonstration, let's say it's appended to a specific div
            $('#yourTargetDiv').append($newSelect);

            // Initialize Select2 on the new element
            initializeSelect2WithTags($newSelect);
        }

        function encodeId(str) {
            return str.replace(/[^a-zA-Z0-9]/g, function(s) {
                return '_' + s.charCodeAt(0).toString(16);
    });
}


        var multipleDeliveriesData = {};

        $('#product_selector .select2').select2({
    width: '100%',
    tags: true,
    minimumInputLength: 1,
    placeholder: "Choose Product",
}).on('select2:select select2:unselect', function(e) {
    var selectedProducts = $(this).val() || []; // Get selected values, ensure array
    var $sizeSelectorsContainer = $('#size-selectors-container');
    $sizeSelectorsContainer.empty(); // Clear previous entries

    selectedProducts.forEach(function(product) {
        var productName = $('#product_selector .select2 option[value="' + product + '"]').text();
        var modalId = encodeId('multipleDeliveriesModal-' + product);
        var elementHtml = `
            <hr>
            <div class="form-group product-detail" data-product-name="${productName}" data-modal-id="${modalId}">
                <input type="hidden" class="product-name" value="${productName}">
                <div class="form-group">
                    <label class="form-label">${productName} Size Selection</label>
                    <input type="text" class="form-control required" placeholder="Enter sizes for ${productName}" />
                </div>
                <div class="form-group">
                    <label class="form-label">${productName} Specs</label>
                    <textarea class="form-control product-specs" placeholder="Enter specs for ${productName}" rows="4" style="height: 100px;"></textarea>
                    <div style="display: flex; align-items: center; margin-top: 10px;">
                        <input type="file" class="form-control file" />
                        <span class="remove-file-text" style="display: none; margin-left: 10px; color: red; cursor: pointer;">Remove</span>
                    </div>
                </div>
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label class="form-label">${productName} Quantity</label>
                    </div>
                    <div class="input-group">
                        <input type="number" class="form-control required quantity-field" placeholder="Quantity (specify if MTS, KGS, or PCS)" aria-label="Quantity input with dropdown button" data-product-name="${productName}" data-modal-id="${modalId}" step="0.01">
                        <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Select Unit</button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="javascript:void(0)" data-unit="MTS">MTS</a></li>
                            <li><a class="dropdown-item" href="javascript:void(0)" data-unit="KGS">KGS</a></li>
                            <li><a class="dropdown-item" href="javascript:void(0)" data-unit="PCS">PCS</a></li>
                        </ul>
                    </div>
                    <input type="hidden" class="quantity-unit" value="">
                </div>
                <div class="form-group">
                    <label class="form-label">${productName} Packaging per inquiry</label>
                    <input type="text" class="form-control required" placeholder="Packaging details" />
                </div>
                <div class="form-group">
                    <label class="form-label">${productName} Target Price</label>
                    <input type="text" class="form-control required" placeholder="Enter target price for ${productName}" />
                </div>
            </div>
            ${createModalTemplate(modalId, productName)}
        `;
        $sizeSelectorsContainer.append(elementHtml);
    });
});

// Function to create modal template
function createModalTemplate(modalId, productName) {
    return `
        <div class="modal fade" id="${modalId}" tabindex="-1" role="dialog" aria-labelledby="${modalId}Label" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="${modalId}Label">Delivery Schedule for ${productName}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="multipleDeliveriesTableContainer" class="table-responsive">
                            <table class="table border text-nowrap text-md-nowrap table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Quantity</th>
                                        <th>Sizes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="multipleDeliveriesTableBody-${modalId}">
                                    <tr>
                                        <td><input type="date" class="form-control"></td>
                                        <td><input type="number" class="form-control delivery-quantity" placeholder="Enter quantity"></td>
                                        <td><input type="text" class="form-control delivery-notes" placeholder="Enter sizes"></td>
                                        <td><button type="button" class="btn btn-danger btn-sm remove-row">Remove</button></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-primary btn-sm mt-2 add-row-button" data-modal-id="${modalId}">Add Row</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary save-changes-button" data-modal-id="${modalId}">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

      // Event delegation for dynamically added elements
        $(document).on('click', '.dropdown-item', function() {
            var selectedText = $(this).text();
            var unit = $(this).data('unit');
            var $inputGroup = $(this).closest('.input-group');
            var $dropdownButton = $inputGroup.find('.dropdown-toggle');
            var $quantityField = $inputGroup.find('.quantity-field');
            var $quantityUnit = $inputGroup.siblings('.quantity-unit'); // Select the sibling hidden input

            $dropdownButton.text(selectedText); // Update button text
            $quantityField.attr('readonly', false); // Enable quantity input
            $quantityUnit.val(unit); // Set the quantity unit

            // Log the value being assigned to the hidden input and the hidden input's value
            console.log("Assigned Unit:", unit);
            console.log("Quantity Unit Value:", $quantityUnit.val());
        });


        $(document).on('change', '.form-control-file', function() {
            var $fileInput = $(this);
            var file = $fileInput[0].files[0];
            var maxSize = 10 * 1024 * 1024; // 10 MB

            if (file && file.size > maxSize) {
                alert('File size exceeds the 10 MB limit.');
                $fileInput.val(''); // Clear the file input
                return;
            }

            var $textarea = $fileInput.closest('.form-group').find('.product-specs');
            var $removeText = $fileInput.closest('.form-group').find('.remove-file-text');

            if ($fileInput.val()) {
                $textarea.val('Attached Specs').prop('readonly', true);
                $removeText.show();
            } else {
                $textarea.val('').prop('readonly', false);
                $removeText.hide();
            }
        });

        $(document).on('click', '.remove-file-text', function() {
            var $removeText = $(this);
            var $fileInput = $removeText.closest('.form-group').find('.form-control-file');
            var $textarea = $removeText.closest('.form-group').find('.product-specs');

            $fileInput.val(''); // Clear the file input
            $textarea.val('').prop('readonly', false); // Reset the textarea
            $removeText.hide(); // Hide the remove text
        });

        $(document).on('focus', '.quantity-field', function() {
            var productName = $(this).data('product-name');
            var modalId = $(this).data('modal-id');
            $('#' + modalId).modal('show'); // Show the specific modal
            updateQuantityField(modalId); // Update the quantity field when the modal is shown
        });

        $(document).on('click', '.quantity-field', function() {
            var productName = $(this).data('product-name');
            var encodedModalId = encodeId('multipleDeliveriesModal-' + productName);
            
            // Create modal template if it doesn't exist
            if (!$('#' + encodedModalId).length) {
                var modalTemplate = createModalTemplate(encodedModalId, productName);
                $('body').append(modalTemplate);
            }
            
            // Open the modal
            $('#' + encodedModalId).modal('show');
});


        function updateQuantityField(modalId) {
            var totalQuantity = 0;
            $('#multipleDeliveriesTableBody-' + modalId + ' .delivery-quantity').each(function() {
                var quantity = parseFloat($(this).val());
                if (!isNaN(quantity)) {
                    totalQuantity += quantity;
                }
            });
            $('.quantity-field[data-modal-id="' + modalId + '"]').val(totalQuantity);
        }

        $(document).on('click', '.add-row-button', function() {
            var modalId = $(this).data('modal-id');
            var rowCount = $('#multipleDeliveriesTableBody-' + modalId + ' tr').length + 1;
            var newRow = `<tr>
                            <td><input type="date" class="form-control"></td>
                            <td><input type="number" class="form-control delivery-quantity" placeholder="Enter quantity"></td>
                            <td><input type="text" class="form-control delivery-notes" placeholder="Enter sizes"></td>
                            <td><button type="button" class="btn btn-danger btn-sm remove-row">Remove</button></td>
                          </tr>`;
            $('#multipleDeliveriesTableBody-' + modalId).append(newRow);
        });

        $(document).on('click', '.remove-row', function() {
            var $row = $(this).closest('tr');
            var modalId = $(this).closest('.modal').attr('id');
            $row.remove();
            $('#multipleDeliveriesTableBody-' + modalId + ' tr').each(function(index) {
                $(this).find('td:first').text(index + 1);
            });
            updateQuantityField(modalId);
        });

        $(document).on('input', '.delivery-quantity', function() {
            var modalId = $(this).closest('.modal').attr('id');
            updateQuantityField(modalId);
        });

        $(document).on('click', '.save-changes-button', function() {
            var modalId = $(this).data('modal-id');
            var productName = $('#size-selectors-container').find(`[data-modal-id="${modalId}"]`).data('product-name');
            multipleDeliveriesData[productName] = [];
            $('#multipleDeliveriesTableBody-' + modalId + ' tr').each(function() {
                var row = {
                    date: $(this).find('td').eq(0).find('input').val(),
                    quantity: $(this).find('td').eq(1).find('input').val(),
                    notes: $(this).find('td').eq(2).find('input').val(),
                };
                multipleDeliveriesData[productName].push(row);
            });
            console.log(JSON.stringify(multipleDeliveriesData)); // Print JSON data to console
            $('#' + modalId).modal('hide'); // Hide the modal
        });


    // Handle form submission
    $('#submit-button-id').click(function(e) {  // Ensure this ID matches your submit button
        e.preventDefault();
        let isValid = true;
        
        // Validate Customer field
        const customerField = $('select[name="customer"]');
        if (customerField.val() === "None") {
            customerField.css('border', '2px solid red');
            isValid = false;
            showStep(0);
            toastr.error('Please select a customer');
        } else {
            customerField.css('border', '');
        }

        // Validate Enquiry Received Date
        const enquiryReceivedDateField = $('#inquiryReceivedDate');
        if (enquiryReceivedDateField.val() === "") {
            enquiryReceivedDateField.css('border', '2px solid red');
            isValid = false;
            showStep(0);
            toastr.error('Please indicate when the enquiry was received');
        } else {
            enquiryReceivedDateField.css('border', '');
        }

        // Validate Quantity and Unit fields for each product
        $('.product-detail').each(function() {
            const quantityField = $(this).find('.quantity-field');
            const unitField = $(this).find('.quantity-unit');
            if (quantityField.val() === "" || unitField.val() === "") {
                quantityField.css('border', '2px solid red');
                unitField.css('border', '2px solid red');
                isValid = false;
                showStep(1);
                toastr.error('Please make sure to indicate the quantity required and the unit')
            } else {
                quantityField.css('border', '');
                unitField.css('border', '');
            }
        });

        // If the form is valid, proceed with form submission
        if (isValid) {
            
   
    // Show the loader
    var loaderHtml = '<div class="dimmer active"><div class="spinner"></div></div>';
    $('body').append(loaderHtml); // Append the loader to the body or a specific div as per your layout

    var data = {
        'manager': $('#managerName').val(), // Ensure IDs are set for input fields
        'client': $('.select2-show-search option:selected').val(),
        'customer_contact': $('#customerContact').val(), // Collecting the contact person's name
        'inquiry_received_date': $('#inquiryReceivedDate').val(),
        'inquiry_deadline_date': $('#inquiryDeadlineDate').val(),
        'incoterm_wanted': $('#incotermWanted').val(), // Collecting the desired incoterm
        'products_details': []
    };

    // Use FormData to send the data, including files
    var formData = new FormData();

    // Enquiry files
    var enquiryFiles = document.getElementById('formFileMultiple').files;
    for (var i = 0; i < enquiryFiles.length; i++) {
        formData.append('enquiry_files[]', enquiryFiles[i]);
    }

    // Iterate over each product details section to collect product info and associated suppliers
    $('#size-selectors-container').children('.product-detail').each(function(index) {
        var $this = $(this);
        var productName = $this.data('product-name'); // Use data-product-name attribute for productName

        var fileInput = $this.find('input[type="file"]')[0]; // Get the file input
        var file = fileInput.files.length > 0 ? fileInput.files[0] : null; // Get the file if it exists

        var productDetails = {
            'product_name': productName,
            'size': $this.find('input[type="text"]').eq(0).val(), // Size is the first input
            'specs': $this.find('.product-specs').val(), // Textarea for specs
            'quantity': $this.find('input[type="number"]').eq(0).val(), // Quantity is the first number input
            'quantity_unit': $this.find('.quantity-unit').val(), // Quantity unit is the hidden input
            'packaging': $this.find('input[type="text"]').eq(1).val(), // Packaging is the second text input
            'target_price': $this.find('input[type="text"]').eq(2).val(), // Target price is the third text input
            'delivery_schedule': multipleDeliveriesData[productName] || [], // Include delivery schedule
            'suppliers': [] // Preparing to collect associated suppliers
        };

        if (file) {
            formData.append(`product_files[${index}]`, file);
        }

        // Find the suppliers section that corresponds to this product
        var suppliersSelection = $('#wizard3-p-2').find(`.form-group[data-product-name="${productName}"]`).find('.select2-suppliers').val();
        if (suppliersSelection) {
            productDetails.suppliers = suppliersSelection;
        }

        data.products_details.push(productDetails);
    });

    formData.append('data', JSON.stringify(data));
    console.log(data);
    $.ajax({
        type: "POST",
        url: "/create_enquiry_ajax", // Adjust URL as needed
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            console.log(response);
            // Handle success - remove the loader
            $('.dimmer').remove();

            // Redirect to the new enquiry page using the pk from the response
            if(response && response.pk) {
                window.location.href = '/enquiry/' + response.pk;
            } else {
                // Handle cases where pk is not returned or response is not as expected
                console.error("Server did not return the expected response.");
            }
        },
        error: function(response) {
            console.log(response);
            // Handle error - remove the loader
            $('.dimmer').remove();
            toastr.error('An error has occurred', "Error");
        }
            });
        }
        });
    });
</script>

<!-- Script to adjust selection boxes in the form -->
<script>
    $(document).ready(function() {
        // Function to initialize Select2 with specified settings
        function initializeSelect2WithTags($elements) {
            $elements.each(function() { // Iterate over each element individually
                var $element = $(this); // Current Select2 element being initialized
                $element.select2({
                    width: '100%',
                    tags: true, // Allows new options to be added
                    minimumInputLength: 1, // Only start searching when at least one character is typed
                    placeholder: "Select suppliers", // Placeholder text
                    createTag: function(params) {
                        var term = $.trim(params.term);
                        if (term === '') {
                            return null;
                        }
                        var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                        // Check for existing options within the current Select2 element
                        var exists = $element.find('option').filter(function() {
                            return $(this).text().toLowerCase() === normalizedTerm;
                        }).length > 0;
                        if (exists) {
                            return null;
                        }
                        return {
                            id: term,
                            text: term,
                            newTag: true
                        };
                    }
                }).on('select2:select', function(e) {
                    if (e.params.data.newTag) {
                        console.log("New option added:", e.params.data.text);
                        // Additional logic for new tags can be implemented here
                    }
                });
            });
        }

        // Initialize Select2 for elements already present
        initializeSelect2WithTags($('.select2-show-search'));

        // Example function to dynamically add new Select2 elements and initialize them
        function addAndInitializeNewSelect2Element() {
            var $newSelect = $('<select class="form-control select2-show-search" multiple=""></select>');
            // Append your new select element to the DOM as needed
            // For demonstration, let's say it's appended to a specific div
            $('#yourTargetDiv').append($newSelect);

            // Initialize Select2 on the new element
            initializeSelect2WithTags($newSelect);
        }
    });
</script>

<!-- Script to add the fields as the user adds products in step 3 of the wizard -->
<script>
    $(document).ready(function() {
        // Define the initialization function outside of any event handler
        function initializeSelect2WithTags($element) {
            $element.select2({
                width: '100%',
                tags: true, // Allows new options to be added
                minimumInputLength: 1, // Only start searching when at least one character is typed
                placeholder: "Select suppliers", // Placeholder text
                createTag: function(params) {
                    var term = $.trim(params.term);
                    if (term === '') {
                        return null;
                    }
                    var normalizedTerm = term.replace(/\s+/g, ' ').toLowerCase();
                    // Check if the normalized term already exists in this specific select's options
                    var exists = $element.find('option').filter(function() {
                        return $(this).text().toLowerCase() === normalizedTerm;
                    }).length > 0;
                    if (exists) {
                        return null;
                    }
                    return {
                        id: term,
                        text: term,
                        newTag: true
                    };
                }
            }).on('select2:select', function(e) {
                if (e.params.data.newTag) {
                    console.log("New option added:", e.params.data.text);
                }
            });
        }

        // Initialize for initially present .select2-show-search elements
        $('.select2-show-search').each(function() {
            initializeSelect2WithTags($(this));
        });

        // Function to handle new selections and unselections
        $('#product_selector .select2').on('select2:select select2:unselect', function(e) {
            var selectedProducts = $(this).val() || [];
            var $stepThreeSection = $('#wizard3-p-2');
            $stepThreeSection.empty();
            selectedProducts.forEach(function(product) {
                var productName = $('#product_selector .select2 option[value="' + product + '"]').text();
                var suppliersSelectHtml = `<div class="form-group" data-product-name="${productName}">
                                               <label class="form-label">${productName} Suppliers to be contacted</label>
                                               <select class="form-control select2-suppliers" multiple="" tabindex="-1" aria-hidden="true">
                                                {% for supplier in suppliers %}
                                                            <option value="{{ supplier }}">{{ supplier }}</option>
                                                {% endfor %}
                                                </select>
                                           </div>`;
                $stepThreeSection.append(suppliersSelectHtml);
            });

            // Re-initialize Select2 for dynamically added .select2-suppliers selects
            $('.select2-suppliers').each(function() {
                initializeSelect2WithTags($(this));
            });
        });
    });
</script>

        

<style>
    .actions ul li a.disabled {
pointer-events: none;
background-color: #ccc; /* Greyed out background */
color: #666; /* Greyed out text */
cursor: not-allowed;
}
</style>

        
    
</body>

</html>